{"ast":null,"code":"import { __awaiter, __generator, __rest } from \"tslib\";\nimport { EncryptedPDFError, FontkitNotRegisteredError, ForeignPageError, RemovePageFromEmptyDocumentError } from \"./errors\";\nimport PDFEmbeddedPage from \"./PDFEmbeddedPage\";\nimport PDFFont from \"./PDFFont\";\nimport PDFImage from \"./PDFImage\";\nimport PDFPage from \"./PDFPage\";\nimport PDFForm from \"./form/PDFForm\";\nimport { PageSizes } from \"./sizes\";\nimport { CustomFontEmbedder, CustomFontSubsetEmbedder, JpegEmbedder, PageEmbeddingMismatchedContextError, PDFCatalog, PDFContext, PDFDict, PDFHexString, PDFName, PDFObjectCopier, PDFPageEmbedder, PDFPageLeaf, PDFPageTree, PDFParser, PDFStreamWriter, PDFString, PDFWriter, PngEmbedder, StandardFontEmbedder, UnexpectedObjectTypeError } from \"../core\";\nimport { ParseSpeeds } from \"./PDFDocumentOptions\";\nimport { assertIs, assertIsOneOfOrUndefined, assertOrUndefined, assertRange, Cache, canBeConvertedToUint8Array, encodeToBase64, isStandardFont, pluckIndices, range, toUint8Array } from \"../utils\";\nimport FileEmbedder, { AFRelationship } from \"../core/embedders/FileEmbedder\";\nimport PDFEmbeddedFile from \"./PDFEmbeddedFile\";\nimport PDFJavaScript from \"./PDFJavaScript\";\nimport JavaScriptEmbedder from \"../core/embedders/JavaScriptEmbedder\";\n/**\r\n * Represents a PDF document.\r\n */\nvar PDFDocument = /** @class */function () {\n  function PDFDocument(context, ignoreEncryption, updateMetadata) {\n    var _this = this;\n    /** The default word breaks used in PDFPage.drawText */\n    this.defaultWordBreaks = [' '];\n    this.computePages = function () {\n      var pages = [];\n      _this.catalog.Pages().traverse(function (node, ref) {\n        if (node instanceof PDFPageLeaf) {\n          var page = _this.pageMap.get(node);\n          if (!page) {\n            page = PDFPage.of(node, ref, _this);\n            _this.pageMap.set(node, page);\n          }\n          pages.push(page);\n        }\n      });\n      return pages;\n    };\n    this.getOrCreateForm = function () {\n      var acroForm = _this.catalog.getOrCreateAcroForm();\n      return PDFForm.of(acroForm, _this);\n    };\n    assertIs(context, 'context', [[PDFContext, 'PDFContext']]);\n    assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\n    this.context = context;\n    this.catalog = context.lookup(context.trailerInfo.Root);\n    this.isEncrypted = !!context.lookup(context.trailerInfo.Encrypt);\n    this.pageCache = Cache.populatedBy(this.computePages);\n    this.pageMap = new Map();\n    this.formCache = Cache.populatedBy(this.getOrCreateForm);\n    this.fonts = [];\n    this.images = [];\n    this.embeddedPages = [];\n    this.embeddedFiles = [];\n    this.javaScripts = [];\n    if (!ignoreEncryption && this.isEncrypted) throw new EncryptedPDFError();\n    if (updateMetadata) this.updateInfoDict();\n  }\n  /**\r\n   * Load an existing [[PDFDocument]]. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                               |\r\n   * | ------------- | ------------------------------------------------------ |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a PDF |\r\n   * | `Uint8Array`  | The raw bytes of a PDF                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a PDF                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * import { PDFDocument } from 'pdf-lib'\r\n   *\r\n   * // pdf=string\r\n   * const base64 =\r\n   *  'JVBERi0xLjcKJYGBgYEKCjUgMCBvYmoKPDwKL0ZpbHRlciAvRmxhdGVEZWNvZGUKL0xlbm' +\r\n   *  'd0aCAxMDQKPj4Kc3RyZWFtCniccwrhMlAAwaJ0Ln2P1Jyy1JLM5ERdc0MjCwUjE4WQNC4Q' +\r\n   *  '6cNlCFZkqGCqYGSqEJLLZWNuYGZiZmbkYuZsZmlmZGRgZmluDCQNzc3NTM2NzdzMXMxMjQ' +\r\n   *  'ztFEKyuEK0uFxDuAAOERdVCmVuZHN0cmVhbQplbmRvYmoKCjYgMCBvYmoKPDwKL0ZpbHRl' +\r\n   *  'ciAvRmxhdGVEZWNvZGUKL1R5cGUgL09ialN0bQovTiA0Ci9GaXJzdCAyMAovTGVuZ3RoID' +\r\n   *  'IxNQo+PgpzdHJlYW0KeJxVj9GqwjAMhu/zFHkBzTo3nCCCiiKIHPEICuJF3cKoSCu2E8/b' +\r\n   *  '20wPIr1p8v9/8kVhgilmGfawX2CGaVrgcAi0/bsy0lrX7IGWpvJ4iJYEN3gEmrrGBlQwGs' +\r\n   *  'HHO9VBX1wNrxAqMX87RBD5xpJuddqwd82tjAHxzV1U5LPgy52DKXWnr1Lheg+j/c/pzGVr' +\r\n   *  'iqV0VlwZPXGPCJjElw/ybkwUmeoWgxesDXGhHJC/D/iikp1Av80ptKU0FdBEe25pPihAM1' +\r\n   *  'u6ytgaaWfs2Hrz35CJT1+EWmAKZW5kc3RyZWFtCmVuZG9iagoKNyAwIG9iago8PAovU2l6' +\r\n   *  'ZSA4Ci9Sb290IDIgMCBSCi9GaWx0ZXIgL0ZsYXRlRGVjb2RlCi9UeXBlIC9YUmVmCi9MZW' +\r\n   *  '5ndGggMzgKL1cgWyAxIDIgMiBdCi9JbmRleCBbIDAgOCBdCj4+CnN0cmVhbQp4nBXEwREA' +\r\n   *  'EBAEsCwz3vrvRmOOyyOoGhZdutHN2MT55fIAVocD+AplbmRzdHJlYW0KZW5kb2JqCgpzdG' +\r\n   *  'FydHhyZWYKNTEwCiUlRU9G'\r\n   *\r\n   * const dataUri = 'data:application/pdf;base64,' + base64\r\n   *\r\n   * const pdfDoc1 = await PDFDocument.load(base64)\r\n   * const pdfDoc2 = await PDFDocument.load(dataUri)\r\n   *\r\n   * // pdf=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('with_update_sections.pdf')\r\n   * const pdfDoc3 = await PDFDocument.load(uint8Array)\r\n   *\r\n   * // pdf=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/with_update_sections.pdf'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const pdfDoc4 = await PDFDocument.load(arrayBuffer)\r\n   *\r\n   * ```\r\n   *\r\n   * @param pdf The input data containing a PDF document.\r\n   * @param options The options to be used when loading the document.\r\n   * @returns Resolves with a document loaded from the input.\r\n   */\n  PDFDocument.load = function (pdf, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, ignoreEncryption, _b, parseSpeed, _c, throwOnInvalidObject, _d, updateMetadata, _e, capNumbers, bytes, context;\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            _a = options.ignoreEncryption, ignoreEncryption = _a === void 0 ? false : _a, _b = options.parseSpeed, parseSpeed = _b === void 0 ? ParseSpeeds.Slow : _b, _c = options.throwOnInvalidObject, throwOnInvalidObject = _c === void 0 ? false : _c, _d = options.updateMetadata, updateMetadata = _d === void 0 ? true : _d, _e = options.capNumbers, capNumbers = _e === void 0 ? false : _e;\n            assertIs(pdf, 'pdf', ['string', Uint8Array, ArrayBuffer]);\n            assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\n            assertIs(parseSpeed, 'parseSpeed', ['number']);\n            assertIs(throwOnInvalidObject, 'throwOnInvalidObject', ['boolean']);\n            bytes = toUint8Array(pdf);\n            return [4 /*yield*/, PDFParser.forBytesWithOptions(bytes, parseSpeed, throwOnInvalidObject, capNumbers).parseDocument()];\n          case 1:\n            context = _f.sent();\n            return [2 /*return*/, new PDFDocument(context, ignoreEncryption, updateMetadata)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Create a new [[PDFDocument]].\r\n   * @returns Resolves with the newly created document.\r\n   */\n  PDFDocument.create = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, updateMetadata, context, pageTree, pageTreeRef, catalog;\n      return __generator(this, function (_b) {\n        _a = options.updateMetadata, updateMetadata = _a === void 0 ? true : _a;\n        context = PDFContext.create();\n        pageTree = PDFPageTree.withContext(context);\n        pageTreeRef = context.register(pageTree);\n        catalog = PDFCatalog.withContextAndPages(context, pageTreeRef);\n        context.trailerInfo.Root = context.register(catalog);\n        return [2 /*return*/, new PDFDocument(context, false, updateMetadata)];\n      });\n    });\n  };\n  /**\r\n   * Register a fontkit instance. This must be done before custom fonts can\r\n   * be embedded. See [here](https://github.com/Hopding/pdf-lib/tree/master#fontkit-installation)\r\n   * for instructions on how to install and register a fontkit instance.\r\n   *\r\n   * > You do **not** need to call this method to embed standard fonts.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * import { PDFDocument } from 'pdf-lib'\r\n   * import fontkit from '@pdf-lib/fontkit'\r\n   *\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * pdfDoc.registerFontkit(fontkit)\r\n   * ```\r\n   *\r\n   * @param fontkit The fontkit instance to be registered.\r\n   */\n  PDFDocument.prototype.registerFontkit = function (fontkit) {\n    this.fontkit = fontkit;\n  };\n  /**\r\n   * Get the [[PDFForm]] containing all interactive fields for this document.\r\n   * For example:\r\n   * ```js\r\n   * const form = pdfDoc.getForm()\r\n   * const fields = form.getFields()\r\n   * fields.forEach(field => {\r\n   *   const type = field.constructor.name\r\n   *   const name = field.getName()\r\n   *   console.log(`${type}: ${name}`)\r\n   * })\r\n   * ```\r\n   * @returns The form for this document.\r\n   */\n  PDFDocument.prototype.getForm = function () {\n    var form = this.formCache.access();\n    if (form.hasXFA()) {\n      console.warn('Removing XFA form data as pdf-lib does not support reading or writing XFA');\n      form.deleteXFA();\n    }\n    return form;\n  };\n  /**\r\n   * Get this document's title metadata. The title appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const title = pdfDoc.getTitle()\r\n   * ```\r\n   * @returns A string containing the title of this document, if it has one.\r\n   */\n  PDFDocument.prototype.getTitle = function () {\n    var title = this.getInfoDict().lookup(PDFName.Title);\n    if (!title) return undefined;\n    assertIsLiteralOrHexString(title);\n    return title.decodeText();\n  };\n  /**\r\n   * Get this document's author metadata. The author appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const author = pdfDoc.getAuthor()\r\n   * ```\r\n   * @returns A string containing the author of this document, if it has one.\r\n   */\n  PDFDocument.prototype.getAuthor = function () {\n    var author = this.getInfoDict().lookup(PDFName.Author);\n    if (!author) return undefined;\n    assertIsLiteralOrHexString(author);\n    return author.decodeText();\n  };\n  /**\r\n   * Get this document's subject metadata. The subject appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const subject = pdfDoc.getSubject()\r\n   * ```\r\n   * @returns A string containing the subject of this document, if it has one.\r\n   */\n  PDFDocument.prototype.getSubject = function () {\n    var subject = this.getInfoDict().lookup(PDFName.Subject);\n    if (!subject) return undefined;\n    assertIsLiteralOrHexString(subject);\n    return subject.decodeText();\n  };\n  /**\r\n   * Get this document's keywords metadata. The keywords appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const keywords = pdfDoc.getKeywords()\r\n   * ```\r\n   * @returns A string containing the keywords of this document, if it has any.\r\n   */\n  PDFDocument.prototype.getKeywords = function () {\n    var keywords = this.getInfoDict().lookup(PDFName.Keywords);\n    if (!keywords) return undefined;\n    assertIsLiteralOrHexString(keywords);\n    return keywords.decodeText();\n  };\n  /**\r\n   * Get this document's creator metadata. The creator appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const creator = pdfDoc.getCreator()\r\n   * ```\r\n   * @returns A string containing the creator of this document, if it has one.\r\n   */\n  PDFDocument.prototype.getCreator = function () {\n    var creator = this.getInfoDict().lookup(PDFName.Creator);\n    if (!creator) return undefined;\n    assertIsLiteralOrHexString(creator);\n    return creator.decodeText();\n  };\n  /**\r\n   * Get this document's producer metadata. The producer appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const producer = pdfDoc.getProducer()\r\n   * ```\r\n   * @returns A string containing the producer of this document, if it has one.\r\n   */\n  PDFDocument.prototype.getProducer = function () {\n    var producer = this.getInfoDict().lookup(PDFName.Producer);\n    if (!producer) return undefined;\n    assertIsLiteralOrHexString(producer);\n    return producer.decodeText();\n  };\n  /**\r\n   * Get this document's creation date metadata. The creation date appears in\r\n   * the \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const creationDate = pdfDoc.getCreationDate()\r\n   * ```\r\n   * @returns A Date containing the creation date of this document,\r\n   *          if it has one.\r\n   */\n  PDFDocument.prototype.getCreationDate = function () {\n    var creationDate = this.getInfoDict().lookup(PDFName.CreationDate);\n    if (!creationDate) return undefined;\n    assertIsLiteralOrHexString(creationDate);\n    return creationDate.decodeDate();\n  };\n  /**\r\n   * Get this document's modification date metadata. The modification date\r\n   * appears in the \"Document Properties\" section of most PDF readers.\r\n   * For example:\r\n   * ```js\r\n   * const modification = pdfDoc.getModificationDate()\r\n   * ```\r\n   * @returns A Date containing the modification date of this document,\r\n   *          if it has one.\r\n   */\n  PDFDocument.prototype.getModificationDate = function () {\n    var modificationDate = this.getInfoDict().lookup(PDFName.ModDate);\n    if (!modificationDate) return undefined;\n    assertIsLiteralOrHexString(modificationDate);\n    return modificationDate.decodeDate();\n  };\n  /**\r\n   * Set this document's title metadata. The title will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setTitle('🥚 The Life of an Egg 🍳')\r\n   * ```\r\n   *\r\n   * To display the title in the window's title bar, set the\r\n   * `showInWindowTitleBar` option to `true` (works for _most_ PDF readers).\r\n   * For example:\r\n   * ```js\r\n   * pdfDoc.setTitle('🥚 The Life of an Egg 🍳', { showInWindowTitleBar: true })\r\n   * ```\r\n   *\r\n   * @param title The title of this document.\r\n   * @param options The options to be used when setting the title.\r\n   */\n  PDFDocument.prototype.setTitle = function (title, options) {\n    assertIs(title, 'title', ['string']);\n    var key = PDFName.of('Title');\n    this.getInfoDict().set(key, PDFHexString.fromText(title));\n    // Indicate that readers should display the title rather than the filename\n    if (options === null || options === void 0 ? void 0 : options.showInWindowTitleBar) {\n      var prefs = this.catalog.getOrCreateViewerPreferences();\n      prefs.setDisplayDocTitle(true);\n    }\n  };\n  /**\r\n   * Set this document's author metadata. The author will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setAuthor('Humpty Dumpty')\r\n   * ```\r\n   * @param author The author of this document.\r\n   */\n  PDFDocument.prototype.setAuthor = function (author) {\n    assertIs(author, 'author', ['string']);\n    var key = PDFName.of('Author');\n    this.getInfoDict().set(key, PDFHexString.fromText(author));\n  };\n  /**\r\n   * Set this document's subject metadata. The subject will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setSubject('📘 An Epic Tale of Woe 📖')\r\n   * ```\r\n   * @param subject The subject of this document.\r\n   */\n  PDFDocument.prototype.setSubject = function (subject) {\n    assertIs(subject, 'author', ['string']);\n    var key = PDFName.of('Subject');\n    this.getInfoDict().set(key, PDFHexString.fromText(subject));\n  };\n  /**\r\n   * Set this document's keyword metadata. These keywords will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setKeywords(['eggs', 'wall', 'fall', 'king', 'horses', 'men'])\r\n   * ```\r\n   * @param keywords An array of keywords associated with this document.\r\n   */\n  PDFDocument.prototype.setKeywords = function (keywords) {\n    assertIs(keywords, 'keywords', [Array]);\n    var key = PDFName.of('Keywords');\n    this.getInfoDict().set(key, PDFHexString.fromText(keywords.join(' ')));\n  };\n  /**\r\n   * Set this document's creator metadata. The creator will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setCreator('PDF App 9000 🤖')\r\n   * ```\r\n   * @param creator The creator of this document.\r\n   */\n  PDFDocument.prototype.setCreator = function (creator) {\n    assertIs(creator, 'creator', ['string']);\n    var key = PDFName.of('Creator');\n    this.getInfoDict().set(key, PDFHexString.fromText(creator));\n  };\n  /**\r\n   * Set this document's producer metadata. The producer will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setProducer('PDF App 9000 🤖')\r\n   * ```\r\n   * @param producer The producer of this document.\r\n   */\n  PDFDocument.prototype.setProducer = function (producer) {\n    assertIs(producer, 'creator', ['string']);\n    var key = PDFName.of('Producer');\n    this.getInfoDict().set(key, PDFHexString.fromText(producer));\n  };\n  /**\r\n   * Set this document's language metadata. The language will appear in the\r\n   * \"Document Properties\" section of some PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setLanguage('en-us')\r\n   * ```\r\n   *\r\n   * @param language An RFC 3066 _Language-Tag_ denoting the language of this\r\n   *                 document, or an empty string if the language is unknown.\r\n   */\n  PDFDocument.prototype.setLanguage = function (language) {\n    assertIs(language, 'language', ['string']);\n    var key = PDFName.of('Lang');\n    this.catalog.set(key, PDFString.of(language));\n  };\n  /**\r\n   * Set this document's creation date metadata. The creation date will appear\r\n   * in the \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setCreationDate(new Date())\r\n   * ```\r\n   * @param creationDate The date this document was created.\r\n   */\n  PDFDocument.prototype.setCreationDate = function (creationDate) {\n    assertIs(creationDate, 'creationDate', [[Date, 'Date']]);\n    var key = PDFName.of('CreationDate');\n    this.getInfoDict().set(key, PDFString.fromDate(creationDate));\n  };\n  /**\r\n   * Set this document's modification date metadata. The modification date will\r\n   * appear in the \"Document Properties\" section of most PDF readers. For\r\n   * example:\r\n   * ```js\r\n   * pdfDoc.setModificationDate(new Date())\r\n   * ```\r\n   * @param modificationDate The date this document was last modified.\r\n   */\n  PDFDocument.prototype.setModificationDate = function (modificationDate) {\n    assertIs(modificationDate, 'modificationDate', [[Date, 'Date']]);\n    var key = PDFName.of('ModDate');\n    this.getInfoDict().set(key, PDFString.fromDate(modificationDate));\n  };\n  /**\r\n   * Get the number of pages contained in this document. For example:\r\n   * ```js\r\n   * const totalPages = pdfDoc.getPageCount()\r\n   * ```\r\n   * @returns The number of pages in this document.\r\n   */\n  PDFDocument.prototype.getPageCount = function () {\n    if (this.pageCount === undefined) this.pageCount = this.getPages().length;\n    return this.pageCount;\n  };\n  /**\r\n   * Get an array of all the pages contained in this document. The pages are\r\n   * stored in the array in the same order that they are rendered in the\r\n   * document. For example:\r\n   * ```js\r\n   * const pages = pdfDoc.getPages()\r\n   * pages[0]   // The first page of the document\r\n   * pages[2]   // The third page of the document\r\n   * pages[197] // The 198th page of the document\r\n   * ```\r\n   * @returns An array of all the pages contained in this document.\r\n   */\n  PDFDocument.prototype.getPages = function () {\n    return this.pageCache.access();\n  };\n  /**\r\n   * Get the page rendered at a particular `index` of the document. For example:\r\n   * ```js\r\n   * pdfDoc.getPage(0)   // The first page of the document\r\n   * pdfDoc.getPage(2)   // The third page of the document\r\n   * pdfDoc.getPage(197) // The 198th page of the document\r\n   * ```\r\n   * @returns The [[PDFPage]] rendered at the given `index` of the document.\r\n   */\n  PDFDocument.prototype.getPage = function (index) {\n    var pages = this.getPages();\n    assertRange(index, 'index', 0, pages.length - 1);\n    return pages[index];\n  };\n  /**\r\n   * Get an array of indices for all the pages contained in this document. The\r\n   * array will contain a range of integers from\r\n   * `0..pdfDoc.getPageCount() - 1`. For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * pdfDoc.addPage()\r\n   * pdfDoc.addPage()\r\n   * pdfDoc.addPage()\r\n   *\r\n   * const indices = pdfDoc.getPageIndices()\r\n   * indices // => [0, 1, 2]\r\n   * ```\r\n   * @returns An array of indices for all pages contained in this document.\r\n   */\n  PDFDocument.prototype.getPageIndices = function () {\n    return range(0, this.getPageCount());\n  };\n  /**\r\n   * Remove the page at a given index from this document. For example:\r\n   * ```js\r\n   * pdfDoc.removePage(0)   // Remove the first page of the document\r\n   * pdfDoc.removePage(2)   // Remove the third page of the document\r\n   * pdfDoc.removePage(197) // Remove the 198th page of the document\r\n   * ```\r\n   * Once a page has been removed, it will no longer be rendered at that index\r\n   * in the document.\r\n   * @param index The index of the page to be removed.\r\n   */\n  PDFDocument.prototype.removePage = function (index) {\n    var pageCount = this.getPageCount();\n    if (this.pageCount === 0) throw new RemovePageFromEmptyDocumentError();\n    assertRange(index, 'index', 0, pageCount - 1);\n    this.catalog.removeLeafNode(index);\n    this.pageCount = pageCount - 1;\n  };\n  /**\r\n   * Add a page to the end of this document. This method accepts three\r\n   * different value types for the `page` parameter:\r\n   *\r\n   * | Type               | Behavior                                                                            |\r\n   * | ------------------ | ----------------------------------------------------------------------------------- |\r\n   * | `undefined`        | Create a new page and add it to the end of this document                            |\r\n   * | `[number, number]` | Create a new page with the given dimensions and add it to the end of this document  |\r\n   * | `PDFPage`          | Add the existing page to the end of this document                                   |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // page=undefined\r\n   * const newPage = pdfDoc.addPage()\r\n   *\r\n   * // page=[number, number]\r\n   * import { PageSizes } from 'pdf-lib'\r\n   * const newPage1 = pdfDoc.addPage(PageSizes.A7)\r\n   * const newPage2 = pdfDoc.addPage(PageSizes.Letter)\r\n   * const newPage3 = pdfDoc.addPage([500, 750])\r\n   *\r\n   * // page=PDFPage\r\n   * const pdfDoc1 = await PDFDocument.create()\r\n   * const pdfDoc2 = await PDFDocument.load(...)\r\n   * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n   * pdfDoc1.addPage(existingPage)\r\n   * ```\r\n   *\r\n   * @param page Optionally, the desired dimensions or existing page.\r\n   * @returns The newly created (or existing) page.\r\n   */\n  PDFDocument.prototype.addPage = function (page) {\n    assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\n    return this.insertPage(this.getPageCount(), page);\n  };\n  /**\r\n   * Insert a page at a given index within this document. This method accepts\r\n   * three different value types for the `page` parameter:\r\n   *\r\n   * | Type               | Behavior                                                                       |\r\n   * | ------------------ | ------------------------------------------------------------------------------ |\r\n   * | `undefined`        | Create a new page and insert it into this document                             |\r\n   * | `[number, number]` | Create a new page with the given dimensions and insert it into this document   |\r\n   * | `PDFPage`          | Insert the existing page into this document                                    |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // page=undefined\r\n   * const newPage = pdfDoc.insertPage(2)\r\n   *\r\n   * // page=[number, number]\r\n   * import { PageSizes } from 'pdf-lib'\r\n   * const newPage1 = pdfDoc.insertPage(2, PageSizes.A7)\r\n   * const newPage2 = pdfDoc.insertPage(0, PageSizes.Letter)\r\n   * const newPage3 = pdfDoc.insertPage(198, [500, 750])\r\n   *\r\n   * // page=PDFPage\r\n   * const pdfDoc1 = await PDFDocument.create()\r\n   * const pdfDoc2 = await PDFDocument.load(...)\r\n   * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n   * pdfDoc1.insertPage(0, existingPage)\r\n   * ```\r\n   *\r\n   * @param index The index at which the page should be inserted (zero-based).\r\n   * @param page Optionally, the desired dimensions or existing page.\r\n   * @returns The newly created (or existing) page.\r\n   */\n  PDFDocument.prototype.insertPage = function (index, page) {\n    var pageCount = this.getPageCount();\n    assertRange(index, 'index', 0, pageCount);\n    assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\n    if (!page || Array.isArray(page)) {\n      var dims = Array.isArray(page) ? page : PageSizes.A4;\n      page = PDFPage.create(this);\n      page.setSize.apply(page, dims);\n    } else if (page.doc !== this) {\n      throw new ForeignPageError();\n    }\n    var parentRef = this.catalog.insertLeafNode(page.ref, index);\n    page.node.setParent(parentRef);\n    this.pageMap.set(page.node, page);\n    this.pageCache.invalidate();\n    this.pageCount = pageCount + 1;\n    return page;\n  };\n  /**\r\n   * Copy pages from a source document into this document. Allows pages to be\r\n   * copied between different [[PDFDocument]] instances. For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * const srcDoc = await PDFDocument.load(...)\r\n   *\r\n   * const copiedPages = await pdfDoc.copyPages(srcDoc, [0, 3, 89])\r\n   * const [firstPage, fourthPage, ninetiethPage] = copiedPages;\r\n   *\r\n   * pdfDoc.addPage(fourthPage)\r\n   * pdfDoc.insertPage(0, ninetiethPage)\r\n   * pdfDoc.addPage(firstPage)\r\n   * ```\r\n   * @param srcDoc The document from which pages should be copied.\r\n   * @param indices The indices of the pages that should be copied.\r\n   * @returns Resolves with an array of pages copied into this document.\r\n   */\n  PDFDocument.prototype.copyPages = function (srcDoc, indices) {\n    return __awaiter(this, void 0, void 0, function () {\n      var copier, srcPages, copiedPages, idx, len, srcPage, copiedPage, ref;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(srcDoc, 'srcDoc', [[PDFDocument, 'PDFDocument']]);\n            assertIs(indices, 'indices', [Array]);\n            return [4 /*yield*/, srcDoc.flush()];\n          case 1:\n            _a.sent();\n            copier = PDFObjectCopier.for(srcDoc.context, this.context);\n            srcPages = srcDoc.getPages();\n            copiedPages = new Array(indices.length);\n            for (idx = 0, len = indices.length; idx < len; idx++) {\n              srcPage = srcPages[indices[idx]];\n              copiedPage = copier.copy(srcPage.node);\n              ref = this.context.register(copiedPage);\n              copiedPages[idx] = PDFPage.of(copiedPage, ref, this);\n            }\n            return [2 /*return*/, copiedPages];\n        }\n      });\n    });\n  };\n  /**\r\n   * Get a copy of this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const srcDoc = await PDFDocument.load(...)\r\n   * const pdfDoc = await srcDoc.copy()\r\n   * ```\r\n   *\r\n   * > **NOTE:**  This method won't copy all information over to the new\r\n   * > document (acroforms, outlines, etc...).\r\n   *\r\n   * @returns Resolves with a copy this document.\r\n   */\n  PDFDocument.prototype.copy = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var pdfCopy, contentPages, idx, len;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, PDFDocument.create()];\n          case 1:\n            pdfCopy = _a.sent();\n            return [4 /*yield*/, pdfCopy.copyPages(this, this.getPageIndices())];\n          case 2:\n            contentPages = _a.sent();\n            for (idx = 0, len = contentPages.length; idx < len; idx++) {\n              pdfCopy.addPage(contentPages[idx]);\n            }\n            if (this.getAuthor() !== undefined) {\n              pdfCopy.setAuthor(this.getAuthor());\n            }\n            if (this.getCreationDate() !== undefined) {\n              pdfCopy.setCreationDate(this.getCreationDate());\n            }\n            if (this.getCreator() !== undefined) {\n              pdfCopy.setCreator(this.getCreator());\n            }\n            if (this.getModificationDate() !== undefined) {\n              pdfCopy.setModificationDate(this.getModificationDate());\n            }\n            if (this.getProducer() !== undefined) {\n              pdfCopy.setProducer(this.getProducer());\n            }\n            if (this.getSubject() !== undefined) {\n              pdfCopy.setSubject(this.getSubject());\n            }\n            if (this.getTitle() !== undefined) {\n              pdfCopy.setTitle(this.getTitle());\n            }\n            pdfCopy.defaultWordBreaks = this.defaultWordBreaks;\n            return [2 /*return*/, pdfCopy];\n        }\n      });\n    });\n  };\n  /**\r\n   * Add JavaScript to this document. The supplied `script` is executed when the\r\n   * document is opened. The `script` can be used to perform some operation\r\n   * when the document is opened (e.g. logging to the console), or it can be\r\n   * used to define a function that can be referenced later in a JavaScript\r\n   * action. For example:\r\n   * ```js\r\n   * // Show \"Hello World!\" in the console when the PDF is opened\r\n   * pdfDoc.addJavaScript(\r\n   *   'main',\r\n   *   'console.show(); console.println(\"Hello World!\");'\r\n   * );\r\n   *\r\n   * // Define a function named \"foo\" that can be called in JavaScript Actions\r\n   * pdfDoc.addJavaScript(\r\n   *   'foo',\r\n   *   'function foo() { return \"foo\"; }'\r\n   * );\r\n   * ```\r\n   * See the [JavaScript for Acrobat API Reference](https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf)\r\n   * for details.\r\n   * @param name The name of the script. Must be unique per document.\r\n   * @param script The JavaScript to execute.\r\n   */\n  PDFDocument.prototype.addJavaScript = function (name, script) {\n    assertIs(name, 'name', ['string']);\n    assertIs(script, 'script', ['string']);\n    var embedder = JavaScriptEmbedder.for(script, name);\n    var ref = this.context.nextRef();\n    var javaScript = PDFJavaScript.of(ref, this, embedder);\n    this.javaScripts.push(javaScript);\n  };\n  /**\r\n   * Add an attachment to this document. Attachments are visible in the\r\n   * \"Attachments\" panel of Adobe Acrobat and some other PDF readers. Any\r\n   * type of file can be added as an attachment. This includes, but is not\r\n   * limited to, `.png`, `.jpg`, `.pdf`, `.csv`, `.docx`, and `.xlsx` files.\r\n   *\r\n   * The input data can be provided in multiple formats:\r\n   *\r\n   * | Type          | Contents                                                       |\r\n   * | ------------- | -------------------------------------------------------------- |\r\n   * | `string`      | A base64 encoded string (or data URI) containing an attachment |\r\n   * | `Uint8Array`  | The raw bytes of an attachment                                 |\r\n   * | `ArrayBuffer` | The raw bytes of an attachment                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // attachment=string\r\n   * await pdfDoc.attach('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...', 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   * await pdfDoc.attach('data:image/jpeg;base64,/9j/4AAQ...', 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   *\r\n   * // attachment=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n   * await pdfDoc.attach(uint8Array, 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   *\r\n   * // attachment=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * await pdfDoc.attach(arrayBuffer, 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   * ```\r\n   *\r\n   * @param attachment The input data containing the file to be attached.\r\n   * @param name The name of the file to be attached.\r\n   * @returns Resolves when the attachment is complete.\r\n   */\n  PDFDocument.prototype.attach = function (attachment, name, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var bytes, embedder, ref, embeddedFile;\n      return __generator(this, function (_a) {\n        assertIs(attachment, 'attachment', ['string', Uint8Array, ArrayBuffer]);\n        assertIs(name, 'name', ['string']);\n        assertOrUndefined(options.mimeType, 'mimeType', ['string']);\n        assertOrUndefined(options.description, 'description', ['string']);\n        assertOrUndefined(options.creationDate, 'options.creationDate', [Date]);\n        assertOrUndefined(options.modificationDate, 'options.modificationDate', [Date]);\n        assertIsOneOfOrUndefined(options.afRelationship, 'options.afRelationship', AFRelationship);\n        bytes = toUint8Array(attachment);\n        embedder = FileEmbedder.for(bytes, name, options);\n        ref = this.context.nextRef();\n        embeddedFile = PDFEmbeddedFile.of(ref, this, embedder);\n        this.embeddedFiles.push(embeddedFile);\n        return [2 /*return*/];\n      });\n    });\n  };\n  /**\r\n   * Embed a font into this document. The input data can be provided in multiple\r\n   * formats:\r\n   *\r\n   * | Type            | Contents                                                |\r\n   * | --------------- | ------------------------------------------------------- |\r\n   * | `StandardFonts` | One of the standard 14 fonts                            |\r\n   * | `string`        | A base64 encoded string (or data URI) containing a font |\r\n   * | `Uint8Array`    | The raw bytes of a font                                 |\r\n   * | `ArrayBuffer`   | The raw bytes of a font                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // font=StandardFonts\r\n   * import { StandardFonts } from 'pdf-lib'\r\n   * const font1 = await pdfDoc.embedFont(StandardFonts.Helvetica)\r\n   *\r\n   * // font=string\r\n   * const font2 = await pdfDoc.embedFont('AAEAAAAVAQAABABQRFNJRx/upe...')\r\n   * const font3 = await pdfDoc.embedFont('data:font/opentype;base64,AAEAAA...')\r\n   *\r\n   * // font=Uint8Array\r\n   * import fs from 'fs'\r\n   * const font4 = await pdfDoc.embedFont(fs.readFileSync('Ubuntu-R.ttf'))\r\n   *\r\n   * // font=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/ubuntu/Ubuntu-R.ttf'\r\n   * const ubuntuBytes = await fetch(url).then(res => res.arrayBuffer())\r\n   * const font5 = await pdfDoc.embedFont(ubuntuBytes)\r\n   * ```\r\n   * See also: [[registerFontkit]]\r\n   * @param font The input data for a font.\r\n   * @param options The options to be used when embedding the font.\r\n   * @returns Resolves with the embedded font.\r\n   */\n  PDFDocument.prototype.embedFont = function (font, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, subset, customName, features, embedder, bytes, fontkit, _b, ref, pdfFont;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _a = options.subset, subset = _a === void 0 ? false : _a, customName = options.customName, features = options.features;\n            assertIs(font, 'font', ['string', Uint8Array, ArrayBuffer]);\n            assertIs(subset, 'subset', ['boolean']);\n            if (!isStandardFont(font)) return [3 /*break*/, 1];\n            embedder = StandardFontEmbedder.for(font, customName);\n            return [3 /*break*/, 7];\n          case 1:\n            if (!canBeConvertedToUint8Array(font)) return [3 /*break*/, 6];\n            bytes = toUint8Array(font);\n            fontkit = this.assertFontkit();\n            if (!subset) return [3 /*break*/, 3];\n            return [4 /*yield*/, CustomFontSubsetEmbedder.for(fontkit, bytes, customName, features)];\n          case 2:\n            _b = _c.sent();\n            return [3 /*break*/, 5];\n          case 3:\n            return [4 /*yield*/, CustomFontEmbedder.for(fontkit, bytes, customName, features)];\n          case 4:\n            _b = _c.sent();\n            _c.label = 5;\n          case 5:\n            embedder = _b;\n            return [3 /*break*/, 7];\n          case 6:\n            throw new TypeError('`font` must be one of `StandardFonts | string | Uint8Array | ArrayBuffer`');\n          case 7:\n            ref = this.context.nextRef();\n            pdfFont = PDFFont.of(ref, this, embedder);\n            this.fonts.push(pdfFont);\n            return [2 /*return*/, pdfFont];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed a standard font into this document.\r\n   * For example:\r\n   * ```js\r\n   * import { StandardFonts } from 'pdf-lib'\r\n   * const helveticaFont = pdfDoc.embedFont(StandardFonts.Helvetica)\r\n   * ```\r\n   * @param font The standard font to be embedded.\r\n   * @param customName The name to be used when embedding the font.\r\n   * @returns The embedded font.\r\n   */\n  PDFDocument.prototype.embedStandardFont = function (font, customName) {\n    assertIs(font, 'font', ['string']);\n    if (!isStandardFont(font)) {\n      throw new TypeError('`font` must be one of type `StandardFonts`');\n    }\n    var embedder = StandardFontEmbedder.for(font, customName);\n    var ref = this.context.nextRef();\n    var pdfFont = PDFFont.of(ref, this, embedder);\n    this.fonts.push(pdfFont);\n    return pdfFont;\n  };\n  /**\r\n   * Embed a JPEG image into this document. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                                      |\r\n   * | ------------- | ------------------------------------------------------------- |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a JPEG image |\r\n   * | `Uint8Array`  | The raw bytes of a JPEG image                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a JPEG image                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // jpg=string\r\n   * const image1 = await pdfDoc.embedJpg('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...')\r\n   * const image2 = await pdfDoc.embedJpg('data:image/jpeg;base64,/9j/4AAQ...')\r\n   *\r\n   * // jpg=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n   * const image3 = await pdfDoc.embedJpg(uint8Array)\r\n   *\r\n   * // jpg=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const image4 = await pdfDoc.embedJpg(arrayBuffer)\r\n   * ```\r\n   *\r\n   * @param jpg The input data for a JPEG image.\r\n   * @returns Resolves with the embedded image.\r\n   */\n  PDFDocument.prototype.embedJpg = function (jpg) {\n    return __awaiter(this, void 0, void 0, function () {\n      var bytes, embedder, ref, pdfImage;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(jpg, 'jpg', ['string', Uint8Array, ArrayBuffer]);\n            bytes = toUint8Array(jpg);\n            return [4 /*yield*/, JpegEmbedder.for(bytes)];\n          case 1:\n            embedder = _a.sent();\n            ref = this.context.nextRef();\n            pdfImage = PDFImage.of(ref, this, embedder);\n            this.images.push(pdfImage);\n            return [2 /*return*/, pdfImage];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed a PNG image into this document. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                                     |\r\n   * | ------------- | ------------------------------------------------------------ |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a PNG image |\r\n   * | `Uint8Array`  | The raw bytes of a PNG image                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a PNG image                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // png=string\r\n   * const image1 = await pdfDoc.embedPng('iVBORw0KGgoAAAANSUhEUgAAAlgAAAF3...')\r\n   * const image2 = await pdfDoc.embedPng('data:image/png;base64,iVBORw0KGg...')\r\n   *\r\n   * // png=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('small_mario.png')\r\n   * const image3 = await pdfDoc.embedPng(uint8Array)\r\n   *\r\n   * // png=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/small_mario.png'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const image4 = await pdfDoc.embedPng(arrayBuffer)\r\n   * ```\r\n   *\r\n   * @param png The input data for a PNG image.\r\n   * @returns Resolves with the embedded image.\r\n   */\n  PDFDocument.prototype.embedPng = function (png) {\n    return __awaiter(this, void 0, void 0, function () {\n      var bytes, embedder, ref, pdfImage;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(png, 'png', ['string', Uint8Array, ArrayBuffer]);\n            bytes = toUint8Array(png);\n            return [4 /*yield*/, PngEmbedder.for(bytes)];\n          case 1:\n            embedder = _a.sent();\n            ref = this.context.nextRef();\n            pdfImage = PDFImage.of(ref, this, embedder);\n            this.images.push(pdfImage);\n            return [2 /*return*/, pdfImage];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed one or more PDF pages into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourcePdf = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   *\r\n   * // Embed page 74 of `sourcePdf` into `pdfDoc`\r\n   * const [embeddedPage] = await pdfDoc.embedPdf(sourcePdf, [73])\r\n   * ```\r\n   *\r\n   * See [[PDFDocument.load]] for examples of the allowed input data formats.\r\n   *\r\n   * @param pdf The input data containing a PDF document.\r\n   * @param indices The indices of the pages that should be embedded.\r\n   * @returns Resolves with an array of the embedded pages.\r\n   */\n  PDFDocument.prototype.embedPdf = function (pdf, indices) {\n    if (indices === void 0) {\n      indices = [0];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var srcDoc, _a, srcPages;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            assertIs(pdf, 'pdf', ['string', Uint8Array, ArrayBuffer, [PDFDocument, 'PDFDocument']]);\n            assertIs(indices, 'indices', [Array]);\n            if (!(pdf instanceof PDFDocument)) return [3 /*break*/, 1];\n            _a = pdf;\n            return [3 /*break*/, 3];\n          case 1:\n            return [4 /*yield*/, PDFDocument.load(pdf)];\n          case 2:\n            _a = _b.sent();\n            _b.label = 3;\n          case 3:\n            srcDoc = _a;\n            srcPages = pluckIndices(srcDoc.getPages(), indices);\n            return [2 /*return*/, this.embedPages(srcPages)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed a single PDF page into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n   * const sourcePdfPage = sourcePdfDoc.getPages()[73]\r\n   *\r\n   * const embeddedPage = await pdfDoc.embedPage(\r\n   *   sourcePdfPage,\r\n   *\r\n   *   // Clip a section of the source page so that we only embed part of it\r\n   *   { left: 100, right: 450, bottom: 330, top: 570 },\r\n   *\r\n   *   // Translate all drawings of the embedded page by (10, 200) units\r\n   *   [1, 0, 0, 1, 10, 200],\r\n   * )\r\n   * ```\r\n   *\r\n   * @param page The page to be embedded.\r\n   * @param boundingBox\r\n   * Optionally, an area of the source page that should be embedded\r\n   * (defaults to entire page).\r\n   * @param transformationMatrix\r\n   * Optionally, a transformation matrix that is always applied to the embedded\r\n   * page anywhere it is drawn.\r\n   * @returns Resolves with the embedded pdf page.\r\n   */\n  PDFDocument.prototype.embedPage = function (page, boundingBox, transformationMatrix) {\n    return __awaiter(this, void 0, void 0, function () {\n      var embeddedPage;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(page, 'page', [[PDFPage, 'PDFPage']]);\n            return [4 /*yield*/, this.embedPages([page], [boundingBox], [transformationMatrix])];\n          case 1:\n            embeddedPage = _a.sent()[0];\n            return [2 /*return*/, embeddedPage];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed one or more PDF pages into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n   *\r\n   * const page1 = sourcePdfDoc.getPages()[0]\r\n   * const page2 = sourcePdfDoc.getPages()[52]\r\n   * const page3 = sourcePdfDoc.getPages()[73]\r\n   *\r\n   * const embeddedPages = await pdfDoc.embedPages([page1, page2, page3])\r\n   * ```\r\n   *\r\n   * @param page\r\n   * The pages to be embedded (they must all share the same context).\r\n   * @param boundingBoxes\r\n   * Optionally, an array of clipping boundaries - one for each page\r\n   * (defaults to entirety of each page).\r\n   * @param transformationMatrices\r\n   * Optionally, an array of transformation matrices - one for each page\r\n   * (each page's transformation will apply anywhere it is drawn).\r\n   * @returns Resolves with an array of the embedded pdf pages.\r\n   */\n  PDFDocument.prototype.embedPages = function (pages, boundingBoxes, transformationMatrices) {\n    if (boundingBoxes === void 0) {\n      boundingBoxes = [];\n    }\n    if (transformationMatrices === void 0) {\n      transformationMatrices = [];\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var idx, len, currPage, nextPage, context, maybeCopyPage, embeddedPages, idx, len, page, box, matrix, embedder, ref;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (pages.length === 0) return [2 /*return*/, []];\n            // Assert all pages have the same context\n            for (idx = 0, len = pages.length - 1; idx < len; idx++) {\n              currPage = pages[idx];\n              nextPage = pages[idx + 1];\n              if (currPage.node.context !== nextPage.node.context) {\n                throw new PageEmbeddingMismatchedContextError();\n              }\n            }\n            context = pages[0].node.context;\n            maybeCopyPage = context === this.context ? function (p) {\n              return p;\n            } : PDFObjectCopier.for(context, this.context).copy;\n            embeddedPages = new Array(pages.length);\n            idx = 0, len = pages.length;\n            _b.label = 1;\n          case 1:\n            if (!(idx < len)) return [3 /*break*/, 4];\n            page = maybeCopyPage(pages[idx].node);\n            box = boundingBoxes[idx];\n            matrix = transformationMatrices[idx];\n            return [4 /*yield*/, PDFPageEmbedder.for(page, box, matrix)];\n          case 2:\n            embedder = _b.sent();\n            ref = this.context.nextRef();\n            embeddedPages[idx] = PDFEmbeddedPage.of(ref, this, embedder);\n            _b.label = 3;\n          case 3:\n            idx++;\n            return [3 /*break*/, 1];\n          case 4:\n            (_a = this.embeddedPages).push.apply(_a, embeddedPages);\n            return [2 /*return*/, embeddedPages];\n        }\n      });\n    });\n  };\n  /**\r\n   * > **NOTE:** You shouldn't need to call this method directly. The [[save]]\r\n   * > and [[saveAsBase64]] methods will automatically ensure that all embedded\r\n   * > assets are flushed before serializing the document.\r\n   *\r\n   * Flush all embedded fonts, PDF pages, and images to this document's\r\n   * [[context]].\r\n   *\r\n   * @returns Resolves when the flush is complete.\r\n   */\n  PDFDocument.prototype.flush = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.embedAll(this.fonts)];\n          case 1:\n            _a.sent();\n            return [4 /*yield*/, this.embedAll(this.images)];\n          case 2:\n            _a.sent();\n            return [4 /*yield*/, this.embedAll(this.embeddedPages)];\n          case 3:\n            _a.sent();\n            return [4 /*yield*/, this.embedAll(this.embeddedFiles)];\n          case 4:\n            _a.sent();\n            return [4 /*yield*/, this.embedAll(this.javaScripts)];\n          case 5:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\r\n   * Serialize this document to an array of bytes making up a PDF file.\r\n   * For example:\r\n   * ```js\r\n   * const pdfBytes = await pdfDoc.save()\r\n   * ```\r\n   *\r\n   * There are a number of things you can do with the serialized document,\r\n   * depending on the JavaScript environment you're running in:\r\n   * * Write it to a file in Node or React Native\r\n   * * Download it as a Blob in the browser\r\n   * * Render it in an `iframe`\r\n   *\r\n   * @param options The options to be used when saving the document.\r\n   * @returns Resolves with the bytes of the serialized document.\r\n   */\n  PDFDocument.prototype.save = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, useObjectStreams, _b, addDefaultPage, _c, objectsPerTick, _d, updateFieldAppearances, form, Writer;\n      return __generator(this, function (_e) {\n        switch (_e.label) {\n          case 0:\n            _a = options.useObjectStreams, useObjectStreams = _a === void 0 ? true : _a, _b = options.addDefaultPage, addDefaultPage = _b === void 0 ? true : _b, _c = options.objectsPerTick, objectsPerTick = _c === void 0 ? 50 : _c, _d = options.updateFieldAppearances, updateFieldAppearances = _d === void 0 ? true : _d;\n            assertIs(useObjectStreams, 'useObjectStreams', ['boolean']);\n            assertIs(addDefaultPage, 'addDefaultPage', ['boolean']);\n            assertIs(objectsPerTick, 'objectsPerTick', ['number']);\n            assertIs(updateFieldAppearances, 'updateFieldAppearances', ['boolean']);\n            if (addDefaultPage && this.getPageCount() === 0) this.addPage();\n            if (updateFieldAppearances) {\n              form = this.formCache.getValue();\n              if (form) form.updateFieldAppearances();\n            }\n            return [4 /*yield*/, this.flush()];\n          case 1:\n            _e.sent();\n            Writer = useObjectStreams ? PDFStreamWriter : PDFWriter;\n            return [2 /*return*/, Writer.forContext(this.context, objectsPerTick).serializeToBuffer()];\n        }\n      });\n    });\n  };\n  /**\r\n   * Serialize this document to a base64 encoded string or data URI making up a\r\n   * PDF file. For example:\r\n   * ```js\r\n   * const base64String = await pdfDoc.saveAsBase64()\r\n   * base64String // => 'JVBERi0xLjcKJYGBgYEKC...'\r\n   *\r\n   * const base64DataUri = await pdfDoc.saveAsBase64({ dataUri: true })\r\n   * base64DataUri // => 'data:application/pdf;base64,JVBERi0xLjcKJYGBgYEKC...'\r\n   * ```\r\n   *\r\n   * @param options The options to be used when saving the document.\r\n   * @returns Resolves with a base64 encoded string or data URI of the\r\n   *          serialized document.\r\n   */\n  PDFDocument.prototype.saveAsBase64 = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, dataUri, otherOptions, bytes, base64;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = options.dataUri, dataUri = _a === void 0 ? false : _a, otherOptions = __rest(options, [\"dataUri\"]);\n            assertIs(dataUri, 'dataUri', ['boolean']);\n            return [4 /*yield*/, this.save(otherOptions)];\n          case 1:\n            bytes = _b.sent();\n            base64 = encodeToBase64(bytes);\n            return [2 /*return*/, dataUri ? \"data:application/pdf;base64,\" + base64 : base64];\n        }\n      });\n    });\n  };\n  PDFDocument.prototype.findPageForAnnotationRef = function (ref) {\n    var pages = this.getPages();\n    for (var idx = 0, len = pages.length; idx < len; idx++) {\n      var page = pages[idx];\n      var annotations = page.node.Annots();\n      if ((annotations === null || annotations === void 0 ? void 0 : annotations.indexOf(ref)) !== undefined) {\n        return page;\n      }\n    }\n    return undefined;\n  };\n  PDFDocument.prototype.embedAll = function (embeddables) {\n    return __awaiter(this, void 0, void 0, function () {\n      var idx, len;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            idx = 0, len = embeddables.length;\n            _a.label = 1;\n          case 1:\n            if (!(idx < len)) return [3 /*break*/, 4];\n            return [4 /*yield*/, embeddables[idx].embed()];\n          case 2:\n            _a.sent();\n            _a.label = 3;\n          case 3:\n            idx++;\n            return [3 /*break*/, 1];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  PDFDocument.prototype.updateInfoDict = function () {\n    var pdfLib = \"pdf-lib (https://github.com/Hopding/pdf-lib)\";\n    var now = new Date();\n    var info = this.getInfoDict();\n    this.setProducer(pdfLib);\n    this.setModificationDate(now);\n    if (!info.get(PDFName.of('Creator'))) this.setCreator(pdfLib);\n    if (!info.get(PDFName.of('CreationDate'))) this.setCreationDate(now);\n  };\n  PDFDocument.prototype.getInfoDict = function () {\n    var existingInfo = this.context.lookup(this.context.trailerInfo.Info);\n    if (existingInfo instanceof PDFDict) return existingInfo;\n    var newInfo = this.context.obj({});\n    this.context.trailerInfo.Info = this.context.register(newInfo);\n    return newInfo;\n  };\n  PDFDocument.prototype.assertFontkit = function () {\n    if (!this.fontkit) throw new FontkitNotRegisteredError();\n    return this.fontkit;\n  };\n  return PDFDocument;\n}();\nexport default PDFDocument;\n/* tslint:disable-next-line only-arrow-functions */\nfunction assertIsLiteralOrHexString(pdfObject) {\n  if (!(pdfObject instanceof PDFHexString) && !(pdfObject instanceof PDFString)) {\n    throw new UnexpectedObjectTypeError([PDFHexString, PDFString], pdfObject);\n  }\n}","map":{"version":3,"names":["EncryptedPDFError","FontkitNotRegisteredError","ForeignPageError","RemovePageFromEmptyDocumentError","PDFEmbeddedPage","PDFFont","PDFImage","PDFPage","PDFForm","PageSizes","CustomFontEmbedder","CustomFontSubsetEmbedder","JpegEmbedder","PageEmbeddingMismatchedContextError","PDFCatalog","PDFContext","PDFDict","PDFHexString","PDFName","PDFObjectCopier","PDFPageEmbedder","PDFPageLeaf","PDFPageTree","PDFParser","PDFStreamWriter","PDFString","PDFWriter","PngEmbedder","StandardFontEmbedder","UnexpectedObjectTypeError","ParseSpeeds","assertIs","assertIsOneOfOrUndefined","assertOrUndefined","assertRange","Cache","canBeConvertedToUint8Array","encodeToBase64","isStandardFont","pluckIndices","range","toUint8Array","FileEmbedder","AFRelationship","PDFEmbeddedFile","PDFJavaScript","JavaScriptEmbedder","PDFDocument","context","ignoreEncryption","updateMetadata","_this","defaultWordBreaks","computePages","pages","catalog","Pages","traverse","node","ref","page","pageMap","get","of","set","push","getOrCreateForm","acroForm","getOrCreateAcroForm","lookup","trailerInfo","Root","isEncrypted","Encrypt","pageCache","populatedBy","Map","formCache","fonts","images","embeddedPages","embeddedFiles","javaScripts","updateInfoDict","load","pdf","options","_a","_b","parseSpeed","Slow","_c","throwOnInvalidObject","_d","_e","capNumbers","Uint8Array","ArrayBuffer","bytes","forBytesWithOptions","parseDocument","_f","sent","create","pageTree","withContext","pageTreeRef","register","withContextAndPages","prototype","registerFontkit","fontkit","getForm","form","access","hasXFA","console","warn","deleteXFA","getTitle","title","getInfoDict","Title","undefined","assertIsLiteralOrHexString","decodeText","getAuthor","author","Author","getSubject","subject","Subject","getKeywords","keywords","Keywords","getCreator","creator","Creator","getProducer","producer","Producer","getCreationDate","creationDate","CreationDate","decodeDate","getModificationDate","modificationDate","ModDate","setTitle","key","fromText","showInWindowTitleBar","prefs","getOrCreateViewerPreferences","setDisplayDocTitle","setAuthor","setSubject","setKeywords","Array","join","setCreator","setProducer","setLanguage","language","setCreationDate","Date","fromDate","setModificationDate","getPageCount","pageCount","getPages","length","getPage","index","getPageIndices","removePage","removeLeafNode","addPage","insertPage","isArray","dims","A4","setSize","apply","doc","parentRef","insertLeafNode","setParent","invalidate","copyPages","srcDoc","indices","flush","copier","for","srcPages","copiedPages","idx","len","srcPage","copiedPage","copy","pdfCopy","contentPages","addJavaScript","name","script","embedder","nextRef","javaScript","attach","attachment","mimeType","description","afRelationship","embeddedFile","embedFont","font","subset","customName","features","assertFontkit","TypeError","pdfFont","embedStandardFont","embedJpg","jpg","pdfImage","embedPng","png","embedPdf","embedPages","embedPage","boundingBox","transformationMatrix","embeddedPage","boundingBoxes","transformationMatrices","currPage","nextPage","maybeCopyPage","p","box","matrix","embedAll","save","useObjectStreams","addDefaultPage","objectsPerTick","updateFieldAppearances","getValue","Writer","forContext","serializeToBuffer","saveAsBase64","dataUri","otherOptions","__rest","base64","findPageForAnnotationRef","annotations","Annots","indexOf","embeddables","embed","pdfLib","now","info","existingInfo","Info","newInfo","obj","pdfObject"],"sources":["C:\\Users\\TongNPZ\\Desktop\\my-app-2.0\\node_modules\\pdf-lib\\src\\api\\PDFDocument.ts"],"sourcesContent":["import Embeddable from 'src/api/Embeddable';\r\nimport {\r\n  EncryptedPDFError,\r\n  FontkitNotRegisteredError,\r\n  ForeignPageError,\r\n  RemovePageFromEmptyDocumentError,\r\n} from 'src/api/errors';\r\nimport PDFEmbeddedPage from 'src/api/PDFEmbeddedPage';\r\nimport PDFFont from 'src/api/PDFFont';\r\nimport PDFImage from 'src/api/PDFImage';\r\nimport PDFPage from 'src/api/PDFPage';\r\nimport PDFForm from 'src/api/form/PDFForm';\r\nimport { PageSizes } from 'src/api/sizes';\r\nimport { StandardFonts } from 'src/api/StandardFonts';\r\nimport {\r\n  CustomFontEmbedder,\r\n  CustomFontSubsetEmbedder,\r\n  JpegEmbedder,\r\n  PageBoundingBox,\r\n  PageEmbeddingMismatchedContextError,\r\n  PDFCatalog,\r\n  PDFContext,\r\n  PDFDict,\r\n  PDFHexString,\r\n  PDFName,\r\n  PDFObjectCopier,\r\n  PDFPageEmbedder,\r\n  PDFPageLeaf,\r\n  PDFPageTree,\r\n  PDFParser,\r\n  PDFStreamWriter,\r\n  PDFString,\r\n  PDFWriter,\r\n  PngEmbedder,\r\n  StandardFontEmbedder,\r\n  UnexpectedObjectTypeError,\r\n} from 'src/core';\r\nimport {\r\n  ParseSpeeds,\r\n  AttachmentOptions,\r\n  SaveOptions,\r\n  Base64SaveOptions,\r\n  LoadOptions,\r\n  CreateOptions,\r\n  EmbedFontOptions,\r\n  SetTitleOptions,\r\n} from 'src/api/PDFDocumentOptions';\r\nimport PDFObject from 'src/core/objects/PDFObject';\r\nimport PDFRef from 'src/core/objects/PDFRef';\r\nimport { Fontkit } from 'src/types/fontkit';\r\nimport { TransformationMatrix } from 'src/types/matrix';\r\nimport {\r\n  assertIs,\r\n  assertIsOneOfOrUndefined,\r\n  assertOrUndefined,\r\n  assertRange,\r\n  Cache,\r\n  canBeConvertedToUint8Array,\r\n  encodeToBase64,\r\n  isStandardFont,\r\n  pluckIndices,\r\n  range,\r\n  toUint8Array,\r\n} from 'src/utils';\r\nimport FileEmbedder, { AFRelationship } from 'src/core/embedders/FileEmbedder';\r\nimport PDFEmbeddedFile from 'src/api/PDFEmbeddedFile';\r\nimport PDFJavaScript from 'src/api/PDFJavaScript';\r\nimport JavaScriptEmbedder from 'src/core/embedders/JavaScriptEmbedder';\r\n\r\n/**\r\n * Represents a PDF document.\r\n */\r\nexport default class PDFDocument {\r\n  /**\r\n   * Load an existing [[PDFDocument]]. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                               |\r\n   * | ------------- | ------------------------------------------------------ |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a PDF |\r\n   * | `Uint8Array`  | The raw bytes of a PDF                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a PDF                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * import { PDFDocument } from 'pdf-lib'\r\n   *\r\n   * // pdf=string\r\n   * const base64 =\r\n   *  'JVBERi0xLjcKJYGBgYEKCjUgMCBvYmoKPDwKL0ZpbHRlciAvRmxhdGVEZWNvZGUKL0xlbm' +\r\n   *  'd0aCAxMDQKPj4Kc3RyZWFtCniccwrhMlAAwaJ0Ln2P1Jyy1JLM5ERdc0MjCwUjE4WQNC4Q' +\r\n   *  '6cNlCFZkqGCqYGSqEJLLZWNuYGZiZmbkYuZsZmlmZGRgZmluDCQNzc3NTM2NzdzMXMxMjQ' +\r\n   *  'ztFEKyuEK0uFxDuAAOERdVCmVuZHN0cmVhbQplbmRvYmoKCjYgMCBvYmoKPDwKL0ZpbHRl' +\r\n   *  'ciAvRmxhdGVEZWNvZGUKL1R5cGUgL09ialN0bQovTiA0Ci9GaXJzdCAyMAovTGVuZ3RoID' +\r\n   *  'IxNQo+PgpzdHJlYW0KeJxVj9GqwjAMhu/zFHkBzTo3nCCCiiKIHPEICuJF3cKoSCu2E8/b' +\r\n   *  '20wPIr1p8v9/8kVhgilmGfawX2CGaVrgcAi0/bsy0lrX7IGWpvJ4iJYEN3gEmrrGBlQwGs' +\r\n   *  'HHO9VBX1wNrxAqMX87RBD5xpJuddqwd82tjAHxzV1U5LPgy52DKXWnr1Lheg+j/c/pzGVr' +\r\n   *  'iqV0VlwZPXGPCJjElw/ybkwUmeoWgxesDXGhHJC/D/iikp1Av80ptKU0FdBEe25pPihAM1' +\r\n   *  'u6ytgaaWfs2Hrz35CJT1+EWmAKZW5kc3RyZWFtCmVuZG9iagoKNyAwIG9iago8PAovU2l6' +\r\n   *  'ZSA4Ci9Sb290IDIgMCBSCi9GaWx0ZXIgL0ZsYXRlRGVjb2RlCi9UeXBlIC9YUmVmCi9MZW' +\r\n   *  '5ndGggMzgKL1cgWyAxIDIgMiBdCi9JbmRleCBbIDAgOCBdCj4+CnN0cmVhbQp4nBXEwREA' +\r\n   *  'EBAEsCwz3vrvRmOOyyOoGhZdutHN2MT55fIAVocD+AplbmRzdHJlYW0KZW5kb2JqCgpzdG' +\r\n   *  'FydHhyZWYKNTEwCiUlRU9G'\r\n   *\r\n   * const dataUri = 'data:application/pdf;base64,' + base64\r\n   *\r\n   * const pdfDoc1 = await PDFDocument.load(base64)\r\n   * const pdfDoc2 = await PDFDocument.load(dataUri)\r\n   *\r\n   * // pdf=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('with_update_sections.pdf')\r\n   * const pdfDoc3 = await PDFDocument.load(uint8Array)\r\n   *\r\n   * // pdf=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/with_update_sections.pdf'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const pdfDoc4 = await PDFDocument.load(arrayBuffer)\r\n   *\r\n   * ```\r\n   *\r\n   * @param pdf The input data containing a PDF document.\r\n   * @param options The options to be used when loading the document.\r\n   * @returns Resolves with a document loaded from the input.\r\n   */\r\n  static async load(\r\n    pdf: string | Uint8Array | ArrayBuffer,\r\n    options: LoadOptions = {},\r\n  ) {\r\n    const {\r\n      ignoreEncryption = false,\r\n      parseSpeed = ParseSpeeds.Slow,\r\n      throwOnInvalidObject = false,\r\n      updateMetadata = true,\r\n      capNumbers = false,\r\n    } = options;\r\n\r\n    assertIs(pdf, 'pdf', ['string', Uint8Array, ArrayBuffer]);\r\n    assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\r\n    assertIs(parseSpeed, 'parseSpeed', ['number']);\r\n    assertIs(throwOnInvalidObject, 'throwOnInvalidObject', ['boolean']);\r\n\r\n    const bytes = toUint8Array(pdf);\r\n    const context = await PDFParser.forBytesWithOptions(\r\n      bytes,\r\n      parseSpeed,\r\n      throwOnInvalidObject,\r\n      capNumbers,\r\n    ).parseDocument();\r\n    return new PDFDocument(context, ignoreEncryption, updateMetadata);\r\n  }\r\n\r\n  /**\r\n   * Create a new [[PDFDocument]].\r\n   * @returns Resolves with the newly created document.\r\n   */\r\n  static async create(options: CreateOptions = {}) {\r\n    const { updateMetadata = true } = options;\r\n\r\n    const context = PDFContext.create();\r\n    const pageTree = PDFPageTree.withContext(context);\r\n    const pageTreeRef = context.register(pageTree);\r\n    const catalog = PDFCatalog.withContextAndPages(context, pageTreeRef);\r\n    context.trailerInfo.Root = context.register(catalog);\r\n\r\n    return new PDFDocument(context, false, updateMetadata);\r\n  }\r\n\r\n  /** The low-level context of this document. */\r\n  readonly context: PDFContext;\r\n\r\n  /** The catalog of this document. */\r\n  readonly catalog: PDFCatalog;\r\n\r\n  /** Whether or not this document is encrypted. */\r\n  readonly isEncrypted: boolean;\r\n\r\n  /** The default word breaks used in PDFPage.drawText */\r\n  defaultWordBreaks: string[] = [' '];\r\n\r\n  private fontkit?: Fontkit;\r\n  private pageCount: number | undefined;\r\n  private readonly pageCache: Cache<PDFPage[]>;\r\n  private readonly pageMap: Map<PDFPageLeaf, PDFPage>;\r\n  private readonly formCache: Cache<PDFForm>;\r\n  private readonly fonts: PDFFont[];\r\n  private readonly images: PDFImage[];\r\n  private readonly embeddedPages: PDFEmbeddedPage[];\r\n  private readonly embeddedFiles: PDFEmbeddedFile[];\r\n  private readonly javaScripts: PDFJavaScript[];\r\n\r\n  private constructor(\r\n    context: PDFContext,\r\n    ignoreEncryption: boolean,\r\n    updateMetadata: boolean,\r\n  ) {\r\n    assertIs(context, 'context', [[PDFContext, 'PDFContext']]);\r\n    assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\r\n\r\n    this.context = context;\r\n    this.catalog = context.lookup(context.trailerInfo.Root) as PDFCatalog;\r\n    this.isEncrypted = !!context.lookup(context.trailerInfo.Encrypt);\r\n\r\n    this.pageCache = Cache.populatedBy(this.computePages);\r\n    this.pageMap = new Map();\r\n    this.formCache = Cache.populatedBy(this.getOrCreateForm);\r\n    this.fonts = [];\r\n    this.images = [];\r\n    this.embeddedPages = [];\r\n    this.embeddedFiles = [];\r\n    this.javaScripts = [];\r\n\r\n    if (!ignoreEncryption && this.isEncrypted) throw new EncryptedPDFError();\r\n\r\n    if (updateMetadata) this.updateInfoDict();\r\n  }\r\n\r\n  /**\r\n   * Register a fontkit instance. This must be done before custom fonts can\r\n   * be embedded. See [here](https://github.com/Hopding/pdf-lib/tree/master#fontkit-installation)\r\n   * for instructions on how to install and register a fontkit instance.\r\n   *\r\n   * > You do **not** need to call this method to embed standard fonts.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * import { PDFDocument } from 'pdf-lib'\r\n   * import fontkit from '@pdf-lib/fontkit'\r\n   *\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * pdfDoc.registerFontkit(fontkit)\r\n   * ```\r\n   *\r\n   * @param fontkit The fontkit instance to be registered.\r\n   */\r\n  registerFontkit(fontkit: Fontkit): void {\r\n    this.fontkit = fontkit;\r\n  }\r\n\r\n  /**\r\n   * Get the [[PDFForm]] containing all interactive fields for this document.\r\n   * For example:\r\n   * ```js\r\n   * const form = pdfDoc.getForm()\r\n   * const fields = form.getFields()\r\n   * fields.forEach(field => {\r\n   *   const type = field.constructor.name\r\n   *   const name = field.getName()\r\n   *   console.log(`${type}: ${name}`)\r\n   * })\r\n   * ```\r\n   * @returns The form for this document.\r\n   */\r\n  getForm(): PDFForm {\r\n    const form = this.formCache.access();\r\n    if (form.hasXFA()) {\r\n      console.warn(\r\n        'Removing XFA form data as pdf-lib does not support reading or writing XFA',\r\n      );\r\n      form.deleteXFA();\r\n    }\r\n    return form;\r\n  }\r\n\r\n  /**\r\n   * Get this document's title metadata. The title appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const title = pdfDoc.getTitle()\r\n   * ```\r\n   * @returns A string containing the title of this document, if it has one.\r\n   */\r\n  getTitle(): string | undefined {\r\n    const title = this.getInfoDict().lookup(PDFName.Title);\r\n    if (!title) return undefined;\r\n    assertIsLiteralOrHexString(title);\r\n    return title.decodeText();\r\n  }\r\n\r\n  /**\r\n   * Get this document's author metadata. The author appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const author = pdfDoc.getAuthor()\r\n   * ```\r\n   * @returns A string containing the author of this document, if it has one.\r\n   */\r\n  getAuthor(): string | undefined {\r\n    const author = this.getInfoDict().lookup(PDFName.Author);\r\n    if (!author) return undefined;\r\n    assertIsLiteralOrHexString(author);\r\n    return author.decodeText();\r\n  }\r\n\r\n  /**\r\n   * Get this document's subject metadata. The subject appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const subject = pdfDoc.getSubject()\r\n   * ```\r\n   * @returns A string containing the subject of this document, if it has one.\r\n   */\r\n  getSubject(): string | undefined {\r\n    const subject = this.getInfoDict().lookup(PDFName.Subject);\r\n    if (!subject) return undefined;\r\n    assertIsLiteralOrHexString(subject);\r\n    return subject.decodeText();\r\n  }\r\n\r\n  /**\r\n   * Get this document's keywords metadata. The keywords appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const keywords = pdfDoc.getKeywords()\r\n   * ```\r\n   * @returns A string containing the keywords of this document, if it has any.\r\n   */\r\n  getKeywords(): string | undefined {\r\n    const keywords = this.getInfoDict().lookup(PDFName.Keywords);\r\n    if (!keywords) return undefined;\r\n    assertIsLiteralOrHexString(keywords);\r\n    return keywords.decodeText();\r\n  }\r\n\r\n  /**\r\n   * Get this document's creator metadata. The creator appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const creator = pdfDoc.getCreator()\r\n   * ```\r\n   * @returns A string containing the creator of this document, if it has one.\r\n   */\r\n  getCreator(): string | undefined {\r\n    const creator = this.getInfoDict().lookup(PDFName.Creator);\r\n    if (!creator) return undefined;\r\n    assertIsLiteralOrHexString(creator);\r\n    return creator.decodeText();\r\n  }\r\n\r\n  /**\r\n   * Get this document's producer metadata. The producer appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const producer = pdfDoc.getProducer()\r\n   * ```\r\n   * @returns A string containing the producer of this document, if it has one.\r\n   */\r\n  getProducer(): string | undefined {\r\n    const producer = this.getInfoDict().lookup(PDFName.Producer);\r\n    if (!producer) return undefined;\r\n    assertIsLiteralOrHexString(producer);\r\n    return producer.decodeText();\r\n  }\r\n\r\n  /**\r\n   * Get this document's creation date metadata. The creation date appears in\r\n   * the \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const creationDate = pdfDoc.getCreationDate()\r\n   * ```\r\n   * @returns A Date containing the creation date of this document,\r\n   *          if it has one.\r\n   */\r\n  getCreationDate(): Date | undefined {\r\n    const creationDate = this.getInfoDict().lookup(PDFName.CreationDate);\r\n    if (!creationDate) return undefined;\r\n    assertIsLiteralOrHexString(creationDate);\r\n    return creationDate.decodeDate();\r\n  }\r\n\r\n  /**\r\n   * Get this document's modification date metadata. The modification date\r\n   * appears in the \"Document Properties\" section of most PDF readers.\r\n   * For example:\r\n   * ```js\r\n   * const modification = pdfDoc.getModificationDate()\r\n   * ```\r\n   * @returns A Date containing the modification date of this document,\r\n   *          if it has one.\r\n   */\r\n  getModificationDate(): Date | undefined {\r\n    const modificationDate = this.getInfoDict().lookup(PDFName.ModDate);\r\n    if (!modificationDate) return undefined;\r\n    assertIsLiteralOrHexString(modificationDate);\r\n    return modificationDate.decodeDate();\r\n  }\r\n\r\n  /**\r\n   * Set this document's title metadata. The title will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setTitle('🥚 The Life of an Egg 🍳')\r\n   * ```\r\n   *\r\n   * To display the title in the window's title bar, set the\r\n   * `showInWindowTitleBar` option to `true` (works for _most_ PDF readers).\r\n   * For example:\r\n   * ```js\r\n   * pdfDoc.setTitle('🥚 The Life of an Egg 🍳', { showInWindowTitleBar: true })\r\n   * ```\r\n   *\r\n   * @param title The title of this document.\r\n   * @param options The options to be used when setting the title.\r\n   */\r\n  setTitle(title: string, options?: SetTitleOptions): void {\r\n    assertIs(title, 'title', ['string']);\r\n    const key = PDFName.of('Title');\r\n    this.getInfoDict().set(key, PDFHexString.fromText(title));\r\n\r\n    // Indicate that readers should display the title rather than the filename\r\n    if (options?.showInWindowTitleBar) {\r\n      const prefs = this.catalog.getOrCreateViewerPreferences();\r\n      prefs.setDisplayDocTitle(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set this document's author metadata. The author will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setAuthor('Humpty Dumpty')\r\n   * ```\r\n   * @param author The author of this document.\r\n   */\r\n  setAuthor(author: string): void {\r\n    assertIs(author, 'author', ['string']);\r\n    const key = PDFName.of('Author');\r\n    this.getInfoDict().set(key, PDFHexString.fromText(author));\r\n  }\r\n\r\n  /**\r\n   * Set this document's subject metadata. The subject will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setSubject('📘 An Epic Tale of Woe 📖')\r\n   * ```\r\n   * @param subject The subject of this document.\r\n   */\r\n  setSubject(subject: string): void {\r\n    assertIs(subject, 'author', ['string']);\r\n    const key = PDFName.of('Subject');\r\n    this.getInfoDict().set(key, PDFHexString.fromText(subject));\r\n  }\r\n\r\n  /**\r\n   * Set this document's keyword metadata. These keywords will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setKeywords(['eggs', 'wall', 'fall', 'king', 'horses', 'men'])\r\n   * ```\r\n   * @param keywords An array of keywords associated with this document.\r\n   */\r\n  setKeywords(keywords: string[]): void {\r\n    assertIs(keywords, 'keywords', [Array]);\r\n    const key = PDFName.of('Keywords');\r\n    this.getInfoDict().set(key, PDFHexString.fromText(keywords.join(' ')));\r\n  }\r\n\r\n  /**\r\n   * Set this document's creator metadata. The creator will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setCreator('PDF App 9000 🤖')\r\n   * ```\r\n   * @param creator The creator of this document.\r\n   */\r\n  setCreator(creator: string): void {\r\n    assertIs(creator, 'creator', ['string']);\r\n    const key = PDFName.of('Creator');\r\n    this.getInfoDict().set(key, PDFHexString.fromText(creator));\r\n  }\r\n\r\n  /**\r\n   * Set this document's producer metadata. The producer will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setProducer('PDF App 9000 🤖')\r\n   * ```\r\n   * @param producer The producer of this document.\r\n   */\r\n  setProducer(producer: string): void {\r\n    assertIs(producer, 'creator', ['string']);\r\n    const key = PDFName.of('Producer');\r\n    this.getInfoDict().set(key, PDFHexString.fromText(producer));\r\n  }\r\n\r\n  /**\r\n   * Set this document's language metadata. The language will appear in the\r\n   * \"Document Properties\" section of some PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setLanguage('en-us')\r\n   * ```\r\n   *\r\n   * @param language An RFC 3066 _Language-Tag_ denoting the language of this\r\n   *                 document, or an empty string if the language is unknown.\r\n   */\r\n  setLanguage(language: string): void {\r\n    assertIs(language, 'language', ['string']);\r\n    const key = PDFName.of('Lang');\r\n    this.catalog.set(key, PDFString.of(language));\r\n  }\r\n\r\n  /**\r\n   * Set this document's creation date metadata. The creation date will appear\r\n   * in the \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setCreationDate(new Date())\r\n   * ```\r\n   * @param creationDate The date this document was created.\r\n   */\r\n  setCreationDate(creationDate: Date): void {\r\n    assertIs(creationDate, 'creationDate', [[Date, 'Date']]);\r\n    const key = PDFName.of('CreationDate');\r\n    this.getInfoDict().set(key, PDFString.fromDate(creationDate));\r\n  }\r\n\r\n  /**\r\n   * Set this document's modification date metadata. The modification date will\r\n   * appear in the \"Document Properties\" section of most PDF readers. For\r\n   * example:\r\n   * ```js\r\n   * pdfDoc.setModificationDate(new Date())\r\n   * ```\r\n   * @param modificationDate The date this document was last modified.\r\n   */\r\n  setModificationDate(modificationDate: Date): void {\r\n    assertIs(modificationDate, 'modificationDate', [[Date, 'Date']]);\r\n    const key = PDFName.of('ModDate');\r\n    this.getInfoDict().set(key, PDFString.fromDate(modificationDate));\r\n  }\r\n\r\n  /**\r\n   * Get the number of pages contained in this document. For example:\r\n   * ```js\r\n   * const totalPages = pdfDoc.getPageCount()\r\n   * ```\r\n   * @returns The number of pages in this document.\r\n   */\r\n  getPageCount(): number {\r\n    if (this.pageCount === undefined) this.pageCount = this.getPages().length;\r\n    return this.pageCount;\r\n  }\r\n\r\n  /**\r\n   * Get an array of all the pages contained in this document. The pages are\r\n   * stored in the array in the same order that they are rendered in the\r\n   * document. For example:\r\n   * ```js\r\n   * const pages = pdfDoc.getPages()\r\n   * pages[0]   // The first page of the document\r\n   * pages[2]   // The third page of the document\r\n   * pages[197] // The 198th page of the document\r\n   * ```\r\n   * @returns An array of all the pages contained in this document.\r\n   */\r\n  getPages(): PDFPage[] {\r\n    return this.pageCache.access();\r\n  }\r\n\r\n  /**\r\n   * Get the page rendered at a particular `index` of the document. For example:\r\n   * ```js\r\n   * pdfDoc.getPage(0)   // The first page of the document\r\n   * pdfDoc.getPage(2)   // The third page of the document\r\n   * pdfDoc.getPage(197) // The 198th page of the document\r\n   * ```\r\n   * @returns The [[PDFPage]] rendered at the given `index` of the document.\r\n   */\r\n  getPage(index: number): PDFPage {\r\n    const pages = this.getPages();\r\n    assertRange(index, 'index', 0, pages.length - 1);\r\n    return pages[index];\r\n  }\r\n\r\n  /**\r\n   * Get an array of indices for all the pages contained in this document. The\r\n   * array will contain a range of integers from\r\n   * `0..pdfDoc.getPageCount() - 1`. For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * pdfDoc.addPage()\r\n   * pdfDoc.addPage()\r\n   * pdfDoc.addPage()\r\n   *\r\n   * const indices = pdfDoc.getPageIndices()\r\n   * indices // => [0, 1, 2]\r\n   * ```\r\n   * @returns An array of indices for all pages contained in this document.\r\n   */\r\n  getPageIndices(): number[] {\r\n    return range(0, this.getPageCount());\r\n  }\r\n\r\n  /**\r\n   * Remove the page at a given index from this document. For example:\r\n   * ```js\r\n   * pdfDoc.removePage(0)   // Remove the first page of the document\r\n   * pdfDoc.removePage(2)   // Remove the third page of the document\r\n   * pdfDoc.removePage(197) // Remove the 198th page of the document\r\n   * ```\r\n   * Once a page has been removed, it will no longer be rendered at that index\r\n   * in the document.\r\n   * @param index The index of the page to be removed.\r\n   */\r\n  removePage(index: number): void {\r\n    const pageCount = this.getPageCount();\r\n    if (this.pageCount === 0) throw new RemovePageFromEmptyDocumentError();\r\n    assertRange(index, 'index', 0, pageCount - 1);\r\n    this.catalog.removeLeafNode(index);\r\n    this.pageCount = pageCount - 1;\r\n  }\r\n\r\n  /**\r\n   * Add a page to the end of this document. This method accepts three\r\n   * different value types for the `page` parameter:\r\n   *\r\n   * | Type               | Behavior                                                                            |\r\n   * | ------------------ | ----------------------------------------------------------------------------------- |\r\n   * | `undefined`        | Create a new page and add it to the end of this document                            |\r\n   * | `[number, number]` | Create a new page with the given dimensions and add it to the end of this document  |\r\n   * | `PDFPage`          | Add the existing page to the end of this document                                   |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // page=undefined\r\n   * const newPage = pdfDoc.addPage()\r\n   *\r\n   * // page=[number, number]\r\n   * import { PageSizes } from 'pdf-lib'\r\n   * const newPage1 = pdfDoc.addPage(PageSizes.A7)\r\n   * const newPage2 = pdfDoc.addPage(PageSizes.Letter)\r\n   * const newPage3 = pdfDoc.addPage([500, 750])\r\n   *\r\n   * // page=PDFPage\r\n   * const pdfDoc1 = await PDFDocument.create()\r\n   * const pdfDoc2 = await PDFDocument.load(...)\r\n   * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n   * pdfDoc1.addPage(existingPage)\r\n   * ```\r\n   *\r\n   * @param page Optionally, the desired dimensions or existing page.\r\n   * @returns The newly created (or existing) page.\r\n   */\r\n  addPage(page?: PDFPage | [number, number]): PDFPage {\r\n    assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\r\n    return this.insertPage(this.getPageCount(), page);\r\n  }\r\n\r\n  /**\r\n   * Insert a page at a given index within this document. This method accepts\r\n   * three different value types for the `page` parameter:\r\n   *\r\n   * | Type               | Behavior                                                                       |\r\n   * | ------------------ | ------------------------------------------------------------------------------ |\r\n   * | `undefined`        | Create a new page and insert it into this document                             |\r\n   * | `[number, number]` | Create a new page with the given dimensions and insert it into this document   |\r\n   * | `PDFPage`          | Insert the existing page into this document                                    |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // page=undefined\r\n   * const newPage = pdfDoc.insertPage(2)\r\n   *\r\n   * // page=[number, number]\r\n   * import { PageSizes } from 'pdf-lib'\r\n   * const newPage1 = pdfDoc.insertPage(2, PageSizes.A7)\r\n   * const newPage2 = pdfDoc.insertPage(0, PageSizes.Letter)\r\n   * const newPage3 = pdfDoc.insertPage(198, [500, 750])\r\n   *\r\n   * // page=PDFPage\r\n   * const pdfDoc1 = await PDFDocument.create()\r\n   * const pdfDoc2 = await PDFDocument.load(...)\r\n   * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n   * pdfDoc1.insertPage(0, existingPage)\r\n   * ```\r\n   *\r\n   * @param index The index at which the page should be inserted (zero-based).\r\n   * @param page Optionally, the desired dimensions or existing page.\r\n   * @returns The newly created (or existing) page.\r\n   */\r\n  insertPage(index: number, page?: PDFPage | [number, number]): PDFPage {\r\n    const pageCount = this.getPageCount();\r\n    assertRange(index, 'index', 0, pageCount);\r\n    assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\r\n    if (!page || Array.isArray(page)) {\r\n      const dims = Array.isArray(page) ? page : PageSizes.A4;\r\n      page = PDFPage.create(this);\r\n      page.setSize(...dims);\r\n    } else if (page.doc !== this) {\r\n      throw new ForeignPageError();\r\n    }\r\n\r\n    const parentRef = this.catalog.insertLeafNode(page.ref, index);\r\n    page.node.setParent(parentRef);\r\n\r\n    this.pageMap.set(page.node, page);\r\n    this.pageCache.invalidate();\r\n\r\n    this.pageCount = pageCount + 1;\r\n\r\n    return page;\r\n  }\r\n\r\n  /**\r\n   * Copy pages from a source document into this document. Allows pages to be\r\n   * copied between different [[PDFDocument]] instances. For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * const srcDoc = await PDFDocument.load(...)\r\n   *\r\n   * const copiedPages = await pdfDoc.copyPages(srcDoc, [0, 3, 89])\r\n   * const [firstPage, fourthPage, ninetiethPage] = copiedPages;\r\n   *\r\n   * pdfDoc.addPage(fourthPage)\r\n   * pdfDoc.insertPage(0, ninetiethPage)\r\n   * pdfDoc.addPage(firstPage)\r\n   * ```\r\n   * @param srcDoc The document from which pages should be copied.\r\n   * @param indices The indices of the pages that should be copied.\r\n   * @returns Resolves with an array of pages copied into this document.\r\n   */\r\n  async copyPages(srcDoc: PDFDocument, indices: number[]): Promise<PDFPage[]> {\r\n    assertIs(srcDoc, 'srcDoc', [[PDFDocument, 'PDFDocument']]);\r\n    assertIs(indices, 'indices', [Array]);\r\n    await srcDoc.flush();\r\n    const copier = PDFObjectCopier.for(srcDoc.context, this.context);\r\n    const srcPages = srcDoc.getPages();\r\n    const copiedPages: PDFPage[] = new Array(indices.length);\r\n    for (let idx = 0, len = indices.length; idx < len; idx++) {\r\n      const srcPage = srcPages[indices[idx]];\r\n      const copiedPage = copier.copy(srcPage.node);\r\n      const ref = this.context.register(copiedPage);\r\n      copiedPages[idx] = PDFPage.of(copiedPage, ref, this);\r\n    }\r\n    return copiedPages;\r\n  }\r\n\r\n  /**\r\n   * Get a copy of this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const srcDoc = await PDFDocument.load(...)\r\n   * const pdfDoc = await srcDoc.copy()\r\n   * ```\r\n   *\r\n   * > **NOTE:**  This method won't copy all information over to the new\r\n   * > document (acroforms, outlines, etc...).\r\n   *\r\n   * @returns Resolves with a copy this document.\r\n   */\r\n  async copy(): Promise<PDFDocument> {\r\n    const pdfCopy = await PDFDocument.create();\r\n    const contentPages = await pdfCopy.copyPages(this, this.getPageIndices());\r\n\r\n    for (let idx = 0, len = contentPages.length; idx < len; idx++) {\r\n      pdfCopy.addPage(contentPages[idx]);\r\n    }\r\n\r\n    if (this.getAuthor() !== undefined) {\r\n      pdfCopy.setAuthor(this.getAuthor()!);\r\n    }\r\n    if (this.getCreationDate() !== undefined) {\r\n      pdfCopy.setCreationDate(this.getCreationDate()!);\r\n    }\r\n    if (this.getCreator() !== undefined) {\r\n      pdfCopy.setCreator(this.getCreator()!);\r\n    }\r\n    if (this.getModificationDate() !== undefined) {\r\n      pdfCopy.setModificationDate(this.getModificationDate()!);\r\n    }\r\n    if (this.getProducer() !== undefined) {\r\n      pdfCopy.setProducer(this.getProducer()!);\r\n    }\r\n    if (this.getSubject() !== undefined) {\r\n      pdfCopy.setSubject(this.getSubject()!);\r\n    }\r\n    if (this.getTitle() !== undefined) {\r\n      pdfCopy.setTitle(this.getTitle()!);\r\n    }\r\n    pdfCopy.defaultWordBreaks = this.defaultWordBreaks;\r\n\r\n    return pdfCopy;\r\n  }\r\n\r\n  /**\r\n   * Add JavaScript to this document. The supplied `script` is executed when the\r\n   * document is opened. The `script` can be used to perform some operation\r\n   * when the document is opened (e.g. logging to the console), or it can be\r\n   * used to define a function that can be referenced later in a JavaScript\r\n   * action. For example:\r\n   * ```js\r\n   * // Show \"Hello World!\" in the console when the PDF is opened\r\n   * pdfDoc.addJavaScript(\r\n   *   'main',\r\n   *   'console.show(); console.println(\"Hello World!\");'\r\n   * );\r\n   *\r\n   * // Define a function named \"foo\" that can be called in JavaScript Actions\r\n   * pdfDoc.addJavaScript(\r\n   *   'foo',\r\n   *   'function foo() { return \"foo\"; }'\r\n   * );\r\n   * ```\r\n   * See the [JavaScript for Acrobat API Reference](https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf)\r\n   * for details.\r\n   * @param name The name of the script. Must be unique per document.\r\n   * @param script The JavaScript to execute.\r\n   */\r\n  addJavaScript(name: string, script: string) {\r\n    assertIs(name, 'name', ['string']);\r\n    assertIs(script, 'script', ['string']);\r\n\r\n    const embedder = JavaScriptEmbedder.for(script, name);\r\n\r\n    const ref = this.context.nextRef();\r\n    const javaScript = PDFJavaScript.of(ref, this, embedder);\r\n    this.javaScripts.push(javaScript);\r\n  }\r\n\r\n  /**\r\n   * Add an attachment to this document. Attachments are visible in the\r\n   * \"Attachments\" panel of Adobe Acrobat and some other PDF readers. Any\r\n   * type of file can be added as an attachment. This includes, but is not\r\n   * limited to, `.png`, `.jpg`, `.pdf`, `.csv`, `.docx`, and `.xlsx` files.\r\n   *\r\n   * The input data can be provided in multiple formats:\r\n   *\r\n   * | Type          | Contents                                                       |\r\n   * | ------------- | -------------------------------------------------------------- |\r\n   * | `string`      | A base64 encoded string (or data URI) containing an attachment |\r\n   * | `Uint8Array`  | The raw bytes of an attachment                                 |\r\n   * | `ArrayBuffer` | The raw bytes of an attachment                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // attachment=string\r\n   * await pdfDoc.attach('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...', 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   * await pdfDoc.attach('data:image/jpeg;base64,/9j/4AAQ...', 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   *\r\n   * // attachment=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n   * await pdfDoc.attach(uint8Array, 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   *\r\n   * // attachment=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * await pdfDoc.attach(arrayBuffer, 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   * ```\r\n   *\r\n   * @param attachment The input data containing the file to be attached.\r\n   * @param name The name of the file to be attached.\r\n   * @returns Resolves when the attachment is complete.\r\n   */\r\n  async attach(\r\n    attachment: string | Uint8Array | ArrayBuffer,\r\n    name: string,\r\n    options: AttachmentOptions = {},\r\n  ): Promise<void> {\r\n    assertIs(attachment, 'attachment', ['string', Uint8Array, ArrayBuffer]);\r\n    assertIs(name, 'name', ['string']);\r\n    assertOrUndefined(options.mimeType, 'mimeType', ['string']);\r\n    assertOrUndefined(options.description, 'description', ['string']);\r\n    assertOrUndefined(options.creationDate, 'options.creationDate', [Date]);\r\n    assertOrUndefined(options.modificationDate, 'options.modificationDate', [\r\n      Date,\r\n    ]);\r\n    assertIsOneOfOrUndefined(\r\n      options.afRelationship,\r\n      'options.afRelationship',\r\n      AFRelationship,\r\n    );\r\n\r\n    const bytes = toUint8Array(attachment);\r\n    const embedder = FileEmbedder.for(bytes, name, options);\r\n\r\n    const ref = this.context.nextRef();\r\n    const embeddedFile = PDFEmbeddedFile.of(ref, this, embedder);\r\n    this.embeddedFiles.push(embeddedFile);\r\n  }\r\n\r\n  /**\r\n   * Embed a font into this document. The input data can be provided in multiple\r\n   * formats:\r\n   *\r\n   * | Type            | Contents                                                |\r\n   * | --------------- | ------------------------------------------------------- |\r\n   * | `StandardFonts` | One of the standard 14 fonts                            |\r\n   * | `string`        | A base64 encoded string (or data URI) containing a font |\r\n   * | `Uint8Array`    | The raw bytes of a font                                 |\r\n   * | `ArrayBuffer`   | The raw bytes of a font                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // font=StandardFonts\r\n   * import { StandardFonts } from 'pdf-lib'\r\n   * const font1 = await pdfDoc.embedFont(StandardFonts.Helvetica)\r\n   *\r\n   * // font=string\r\n   * const font2 = await pdfDoc.embedFont('AAEAAAAVAQAABABQRFNJRx/upe...')\r\n   * const font3 = await pdfDoc.embedFont('data:font/opentype;base64,AAEAAA...')\r\n   *\r\n   * // font=Uint8Array\r\n   * import fs from 'fs'\r\n   * const font4 = await pdfDoc.embedFont(fs.readFileSync('Ubuntu-R.ttf'))\r\n   *\r\n   * // font=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/ubuntu/Ubuntu-R.ttf'\r\n   * const ubuntuBytes = await fetch(url).then(res => res.arrayBuffer())\r\n   * const font5 = await pdfDoc.embedFont(ubuntuBytes)\r\n   * ```\r\n   * See also: [[registerFontkit]]\r\n   * @param font The input data for a font.\r\n   * @param options The options to be used when embedding the font.\r\n   * @returns Resolves with the embedded font.\r\n   */\r\n  async embedFont(\r\n    font: StandardFonts | string | Uint8Array | ArrayBuffer,\r\n    options: EmbedFontOptions = {},\r\n  ): Promise<PDFFont> {\r\n    const { subset = false, customName, features } = options;\r\n\r\n    assertIs(font, 'font', ['string', Uint8Array, ArrayBuffer]);\r\n    assertIs(subset, 'subset', ['boolean']);\r\n\r\n    let embedder: CustomFontEmbedder | StandardFontEmbedder;\r\n    if (isStandardFont(font)) {\r\n      embedder = StandardFontEmbedder.for(font, customName);\r\n    } else if (canBeConvertedToUint8Array(font)) {\r\n      const bytes = toUint8Array(font);\r\n      const fontkit = this.assertFontkit();\r\n      embedder = subset\r\n        ? await CustomFontSubsetEmbedder.for(\r\n            fontkit,\r\n            bytes,\r\n            customName,\r\n            features,\r\n          )\r\n        : await CustomFontEmbedder.for(fontkit, bytes, customName, features);\r\n    } else {\r\n      throw new TypeError(\r\n        '`font` must be one of `StandardFonts | string | Uint8Array | ArrayBuffer`',\r\n      );\r\n    }\r\n\r\n    const ref = this.context.nextRef();\r\n    const pdfFont = PDFFont.of(ref, this, embedder);\r\n    this.fonts.push(pdfFont);\r\n\r\n    return pdfFont;\r\n  }\r\n\r\n  /**\r\n   * Embed a standard font into this document.\r\n   * For example:\r\n   * ```js\r\n   * import { StandardFonts } from 'pdf-lib'\r\n   * const helveticaFont = pdfDoc.embedFont(StandardFonts.Helvetica)\r\n   * ```\r\n   * @param font The standard font to be embedded.\r\n   * @param customName The name to be used when embedding the font.\r\n   * @returns The embedded font.\r\n   */\r\n  embedStandardFont(font: StandardFonts, customName?: string): PDFFont {\r\n    assertIs(font, 'font', ['string']);\r\n    if (!isStandardFont(font)) {\r\n      throw new TypeError('`font` must be one of type `StandardFonts`');\r\n    }\r\n\r\n    const embedder = StandardFontEmbedder.for(font, customName);\r\n\r\n    const ref = this.context.nextRef();\r\n    const pdfFont = PDFFont.of(ref, this, embedder);\r\n    this.fonts.push(pdfFont);\r\n\r\n    return pdfFont;\r\n  }\r\n\r\n  /**\r\n   * Embed a JPEG image into this document. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                                      |\r\n   * | ------------- | ------------------------------------------------------------- |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a JPEG image |\r\n   * | `Uint8Array`  | The raw bytes of a JPEG image                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a JPEG image                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // jpg=string\r\n   * const image1 = await pdfDoc.embedJpg('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...')\r\n   * const image2 = await pdfDoc.embedJpg('data:image/jpeg;base64,/9j/4AAQ...')\r\n   *\r\n   * // jpg=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n   * const image3 = await pdfDoc.embedJpg(uint8Array)\r\n   *\r\n   * // jpg=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const image4 = await pdfDoc.embedJpg(arrayBuffer)\r\n   * ```\r\n   *\r\n   * @param jpg The input data for a JPEG image.\r\n   * @returns Resolves with the embedded image.\r\n   */\r\n  async embedJpg(jpg: string | Uint8Array | ArrayBuffer): Promise<PDFImage> {\r\n    assertIs(jpg, 'jpg', ['string', Uint8Array, ArrayBuffer]);\r\n    const bytes = toUint8Array(jpg);\r\n    const embedder = await JpegEmbedder.for(bytes);\r\n    const ref = this.context.nextRef();\r\n    const pdfImage = PDFImage.of(ref, this, embedder);\r\n    this.images.push(pdfImage);\r\n    return pdfImage;\r\n  }\r\n\r\n  /**\r\n   * Embed a PNG image into this document. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                                     |\r\n   * | ------------- | ------------------------------------------------------------ |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a PNG image |\r\n   * | `Uint8Array`  | The raw bytes of a PNG image                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a PNG image                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // png=string\r\n   * const image1 = await pdfDoc.embedPng('iVBORw0KGgoAAAANSUhEUgAAAlgAAAF3...')\r\n   * const image2 = await pdfDoc.embedPng('data:image/png;base64,iVBORw0KGg...')\r\n   *\r\n   * // png=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('small_mario.png')\r\n   * const image3 = await pdfDoc.embedPng(uint8Array)\r\n   *\r\n   * // png=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/small_mario.png'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const image4 = await pdfDoc.embedPng(arrayBuffer)\r\n   * ```\r\n   *\r\n   * @param png The input data for a PNG image.\r\n   * @returns Resolves with the embedded image.\r\n   */\r\n  async embedPng(png: string | Uint8Array | ArrayBuffer): Promise<PDFImage> {\r\n    assertIs(png, 'png', ['string', Uint8Array, ArrayBuffer]);\r\n    const bytes = toUint8Array(png);\r\n    const embedder = await PngEmbedder.for(bytes);\r\n    const ref = this.context.nextRef();\r\n    const pdfImage = PDFImage.of(ref, this, embedder);\r\n    this.images.push(pdfImage);\r\n    return pdfImage;\r\n  }\r\n\r\n  /**\r\n   * Embed one or more PDF pages into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourcePdf = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   *\r\n   * // Embed page 74 of `sourcePdf` into `pdfDoc`\r\n   * const [embeddedPage] = await pdfDoc.embedPdf(sourcePdf, [73])\r\n   * ```\r\n   *\r\n   * See [[PDFDocument.load]] for examples of the allowed input data formats.\r\n   *\r\n   * @param pdf The input data containing a PDF document.\r\n   * @param indices The indices of the pages that should be embedded.\r\n   * @returns Resolves with an array of the embedded pages.\r\n   */\r\n  async embedPdf(\r\n    pdf: string | Uint8Array | ArrayBuffer | PDFDocument,\r\n    indices: number[] = [0],\r\n  ): Promise<PDFEmbeddedPage[]> {\r\n    assertIs(pdf, 'pdf', [\r\n      'string',\r\n      Uint8Array,\r\n      ArrayBuffer,\r\n      [PDFDocument, 'PDFDocument'],\r\n    ]);\r\n    assertIs(indices, 'indices', [Array]);\r\n\r\n    const srcDoc =\r\n      pdf instanceof PDFDocument ? pdf : await PDFDocument.load(pdf);\r\n\r\n    const srcPages = pluckIndices(srcDoc.getPages(), indices);\r\n\r\n    return this.embedPages(srcPages);\r\n  }\r\n\r\n  /**\r\n   * Embed a single PDF page into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n   * const sourcePdfPage = sourcePdfDoc.getPages()[73]\r\n   *\r\n   * const embeddedPage = await pdfDoc.embedPage(\r\n   *   sourcePdfPage,\r\n   *\r\n   *   // Clip a section of the source page so that we only embed part of it\r\n   *   { left: 100, right: 450, bottom: 330, top: 570 },\r\n   *\r\n   *   // Translate all drawings of the embedded page by (10, 200) units\r\n   *   [1, 0, 0, 1, 10, 200],\r\n   * )\r\n   * ```\r\n   *\r\n   * @param page The page to be embedded.\r\n   * @param boundingBox\r\n   * Optionally, an area of the source page that should be embedded\r\n   * (defaults to entire page).\r\n   * @param transformationMatrix\r\n   * Optionally, a transformation matrix that is always applied to the embedded\r\n   * page anywhere it is drawn.\r\n   * @returns Resolves with the embedded pdf page.\r\n   */\r\n  async embedPage(\r\n    page: PDFPage,\r\n    boundingBox?: PageBoundingBox,\r\n    transformationMatrix?: TransformationMatrix,\r\n  ): Promise<PDFEmbeddedPage> {\r\n    assertIs(page, 'page', [[PDFPage, 'PDFPage']]);\r\n    const [embeddedPage] = await this.embedPages(\r\n      [page],\r\n      [boundingBox],\r\n      [transformationMatrix],\r\n    );\r\n    return embeddedPage;\r\n  }\r\n\r\n  /**\r\n   * Embed one or more PDF pages into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n   *\r\n   * const page1 = sourcePdfDoc.getPages()[0]\r\n   * const page2 = sourcePdfDoc.getPages()[52]\r\n   * const page3 = sourcePdfDoc.getPages()[73]\r\n   *\r\n   * const embeddedPages = await pdfDoc.embedPages([page1, page2, page3])\r\n   * ```\r\n   *\r\n   * @param page\r\n   * The pages to be embedded (they must all share the same context).\r\n   * @param boundingBoxes\r\n   * Optionally, an array of clipping boundaries - one for each page\r\n   * (defaults to entirety of each page).\r\n   * @param transformationMatrices\r\n   * Optionally, an array of transformation matrices - one for each page\r\n   * (each page's transformation will apply anywhere it is drawn).\r\n   * @returns Resolves with an array of the embedded pdf pages.\r\n   */\r\n  async embedPages(\r\n    pages: PDFPage[],\r\n    boundingBoxes: (PageBoundingBox | undefined)[] = [],\r\n    transformationMatrices: (TransformationMatrix | undefined)[] = [],\r\n  ) {\r\n    if (pages.length === 0) return [];\r\n\r\n    // Assert all pages have the same context\r\n    for (let idx = 0, len = pages.length - 1; idx < len; idx++) {\r\n      const currPage = pages[idx];\r\n      const nextPage = pages[idx + 1];\r\n      if (currPage.node.context !== nextPage.node.context) {\r\n        throw new PageEmbeddingMismatchedContextError();\r\n      }\r\n    }\r\n\r\n    const context = pages[0].node.context;\r\n    const maybeCopyPage =\r\n      context === this.context\r\n        ? (p: PDFPageLeaf) => p\r\n        : PDFObjectCopier.for(context, this.context).copy;\r\n\r\n    const embeddedPages = new Array<PDFEmbeddedPage>(pages.length);\r\n    for (let idx = 0, len = pages.length; idx < len; idx++) {\r\n      const page = maybeCopyPage(pages[idx].node);\r\n      const box = boundingBoxes[idx];\r\n      const matrix = transformationMatrices[idx];\r\n\r\n      const embedder = await PDFPageEmbedder.for(page, box, matrix);\r\n\r\n      const ref = this.context.nextRef();\r\n      embeddedPages[idx] = PDFEmbeddedPage.of(ref, this, embedder);\r\n    }\r\n\r\n    this.embeddedPages.push(...embeddedPages);\r\n\r\n    return embeddedPages;\r\n  }\r\n\r\n  /**\r\n   * > **NOTE:** You shouldn't need to call this method directly. The [[save]]\r\n   * > and [[saveAsBase64]] methods will automatically ensure that all embedded\r\n   * > assets are flushed before serializing the document.\r\n   *\r\n   * Flush all embedded fonts, PDF pages, and images to this document's\r\n   * [[context]].\r\n   *\r\n   * @returns Resolves when the flush is complete.\r\n   */\r\n  async flush(): Promise<void> {\r\n    await this.embedAll(this.fonts);\r\n    await this.embedAll(this.images);\r\n    await this.embedAll(this.embeddedPages);\r\n    await this.embedAll(this.embeddedFiles);\r\n    await this.embedAll(this.javaScripts);\r\n  }\r\n\r\n  /**\r\n   * Serialize this document to an array of bytes making up a PDF file.\r\n   * For example:\r\n   * ```js\r\n   * const pdfBytes = await pdfDoc.save()\r\n   * ```\r\n   *\r\n   * There are a number of things you can do with the serialized document,\r\n   * depending on the JavaScript environment you're running in:\r\n   * * Write it to a file in Node or React Native\r\n   * * Download it as a Blob in the browser\r\n   * * Render it in an `iframe`\r\n   *\r\n   * @param options The options to be used when saving the document.\r\n   * @returns Resolves with the bytes of the serialized document.\r\n   */\r\n  async save(options: SaveOptions = {}): Promise<Uint8Array> {\r\n    const {\r\n      useObjectStreams = true,\r\n      addDefaultPage = true,\r\n      objectsPerTick = 50,\r\n      updateFieldAppearances = true,\r\n    } = options;\r\n\r\n    assertIs(useObjectStreams, 'useObjectStreams', ['boolean']);\r\n    assertIs(addDefaultPage, 'addDefaultPage', ['boolean']);\r\n    assertIs(objectsPerTick, 'objectsPerTick', ['number']);\r\n    assertIs(updateFieldAppearances, 'updateFieldAppearances', ['boolean']);\r\n\r\n    if (addDefaultPage && this.getPageCount() === 0) this.addPage();\r\n\r\n    if (updateFieldAppearances) {\r\n      const form = this.formCache.getValue();\r\n      if (form) form.updateFieldAppearances();\r\n    }\r\n\r\n    await this.flush();\r\n\r\n    const Writer = useObjectStreams ? PDFStreamWriter : PDFWriter;\r\n    return Writer.forContext(this.context, objectsPerTick).serializeToBuffer();\r\n  }\r\n\r\n  /**\r\n   * Serialize this document to a base64 encoded string or data URI making up a\r\n   * PDF file. For example:\r\n   * ```js\r\n   * const base64String = await pdfDoc.saveAsBase64()\r\n   * base64String // => 'JVBERi0xLjcKJYGBgYEKC...'\r\n   *\r\n   * const base64DataUri = await pdfDoc.saveAsBase64({ dataUri: true })\r\n   * base64DataUri // => 'data:application/pdf;base64,JVBERi0xLjcKJYGBgYEKC...'\r\n   * ```\r\n   *\r\n   * @param options The options to be used when saving the document.\r\n   * @returns Resolves with a base64 encoded string or data URI of the\r\n   *          serialized document.\r\n   */\r\n  async saveAsBase64(options: Base64SaveOptions = {}): Promise<string> {\r\n    const { dataUri = false, ...otherOptions } = options;\r\n    assertIs(dataUri, 'dataUri', ['boolean']);\r\n    const bytes = await this.save(otherOptions);\r\n    const base64 = encodeToBase64(bytes);\r\n    return dataUri ? `data:application/pdf;base64,${base64}` : base64;\r\n  }\r\n\r\n  findPageForAnnotationRef(ref: PDFRef): PDFPage | undefined {\r\n    const pages = this.getPages();\r\n    for (let idx = 0, len = pages.length; idx < len; idx++) {\r\n      const page = pages[idx];\r\n      const annotations = page.node.Annots();\r\n\r\n      if (annotations?.indexOf(ref) !== undefined) {\r\n        return page;\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  private async embedAll(embeddables: Embeddable[]): Promise<void> {\r\n    for (let idx = 0, len = embeddables.length; idx < len; idx++) {\r\n      await embeddables[idx].embed();\r\n    }\r\n  }\r\n\r\n  private updateInfoDict(): void {\r\n    const pdfLib = `pdf-lib (https://github.com/Hopding/pdf-lib)`;\r\n    const now = new Date();\r\n\r\n    const info = this.getInfoDict();\r\n\r\n    this.setProducer(pdfLib);\r\n    this.setModificationDate(now);\r\n\r\n    if (!info.get(PDFName.of('Creator'))) this.setCreator(pdfLib);\r\n    if (!info.get(PDFName.of('CreationDate'))) this.setCreationDate(now);\r\n  }\r\n\r\n  private getInfoDict(): PDFDict {\r\n    const existingInfo = this.context.lookup(this.context.trailerInfo.Info);\r\n    if (existingInfo instanceof PDFDict) return existingInfo;\r\n\r\n    const newInfo = this.context.obj({});\r\n    this.context.trailerInfo.Info = this.context.register(newInfo);\r\n\r\n    return newInfo;\r\n  }\r\n\r\n  private assertFontkit(): Fontkit {\r\n    if (!this.fontkit) throw new FontkitNotRegisteredError();\r\n    return this.fontkit;\r\n  }\r\n\r\n  private computePages = (): PDFPage[] => {\r\n    const pages: PDFPage[] = [];\r\n    this.catalog.Pages().traverse((node, ref) => {\r\n      if (node instanceof PDFPageLeaf) {\r\n        let page = this.pageMap.get(node);\r\n        if (!page) {\r\n          page = PDFPage.of(node, ref, this);\r\n          this.pageMap.set(node, page);\r\n        }\r\n        pages.push(page);\r\n      }\r\n    });\r\n    return pages;\r\n  };\r\n\r\n  private getOrCreateForm = (): PDFForm => {\r\n    const acroForm = this.catalog.getOrCreateAcroForm();\r\n    return PDFForm.of(acroForm, this);\r\n  };\r\n}\r\n\r\n/* tslint:disable-next-line only-arrow-functions */\r\nfunction assertIsLiteralOrHexString(\r\n  pdfObject: PDFObject,\r\n): asserts pdfObject is PDFHexString | PDFString {\r\n  if (\r\n    !(pdfObject instanceof PDFHexString) &&\r\n    !(pdfObject instanceof PDFString)\r\n  ) {\r\n    throw new UnexpectedObjectTypeError([PDFHexString, PDFString], pdfObject);\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}